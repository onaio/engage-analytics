{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.11", "generated_at": "2025-09-25T18:05:14.419724Z", "invocation_id": "c5a18185-766b-419e-bd21-2d35b689b27f", "invocation_started_at": "2025-09-25T18:05:11.099739Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-25T18:05:11.756390Z", "completed_at": "2025-09-25T18:05:11.808647Z"}, {"name": "execute", "started_at": "2025-09-25T18:05:11.809021Z", "completed_at": "2025-09-25T18:05:14.391981Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.6364738941192627, "adapter_response": {"_message": "MERGE 33", "code": "MERGE", "rows_affected": 33}, "message": "MERGE 33", "failures": null, "unique_id": "model.engage_analytics.fct_metrics_long_incremental", "compiled": true, "compiled_code": "-- models/metrics/fct_metrics_long_incremental.sql\n-- Reprocess last 7 days for late-arriving data\n\nwith\n\nbase_practitioners as (\n  select\n    current_date as period_date,organization_id,\n    count(distinct id) as provider_count_value\n  from \"airbyte\".\"engage_analytics_engage_analytics_mart\".\"practitioners\"\n  where 1=1\n    \n    and active = 'true'\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by organization_id\n),\nbase_patient as (\n  select\n    current_date as period_date,practitioner_organization_id,\n    count(distinct id) as patient_count_value\n  from \"airbyte\".\"engage_analytics_engage_analytics_mart\".\"patient\"\n  where 1=1\n    \n    and active = 'true'\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by practitioner_organization_id\n),\nbase_encounters as (\n  select\n    period_start::date as period_date,practitioner_organization_id,\n    count(distinct subject_id) as client_encounters_value\n  from \"airbyte\".\"engage_analytics_engage_analytics_mart\".\"encounters\"\n  where 1=1\n    \n    and period_start is not null\n    \n    \n    \n      -- For encounters, reprocess recent days for late-arriving data\n      and period_start::date >= current_date - interval '7 days'\n    \n    \n  group by\n    period_start::date, practitioner_organization_id\n),\nbase_active_providers as (\n  select\n    current_date as period_date,organization_id,\n    count(distinct case when is_active_30d then practitioner_id end) as active_providers_value,\n    (count(distinct case when is_active_30d then practitioner_id end)::decimal / nullif(count(distinct practitioner_id), 0)) * 100 as percent_active_providers_value\n  from \"airbyte\".\"engage_analytics\".\"active_providers\"\n  where 1=1\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by organization_id\n),\nbase_clients_eligible_for_ipc as (\n  select\n    current_date as period_date,organization_id,\n    count(distinct subject_patient_id) as clients_eligible_for_ipc_value\n  from \"airbyte\".\"engage_analytics\".\"clients_eligible_for_ipc\"\n  where 1=1\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by organization_id\n),\nbase_clients_sbirt_mi_eligible as (\n  select\n    current_date as period_date,organization_id,\n    count(distinct subject_patient_id) as clients_sbirt_mi_eligible_value\n  from \"airbyte\".\"engage_analytics\".\"clients_sbirt_mi_eligible\"\n  where 1=1\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by organization_id\n),\nbase_clients_eligible_spi as (\n  select\n    current_date as period_date,organization_id,\n    count(distinct subject_patient_id) as clients_eligible_spi_value\n  from \"airbyte\".\"engage_analytics\".\"clients_eligible_spi\"\n  where 1=1\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by organization_id\n),\nbase_clients_eligible_referral as (\n  select\n    current_date as period_date,organization_id,\n    count(distinct subject_patient_id) as clients_eligible_referral_value\n  from \"airbyte\".\"engage_analytics\".\"clients_eligible_referral\"\n  where 1=1\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by organization_id\n),\nbase_clients_eligible_fws as (\n  select\n    current_date as period_date,organization_id,\n    count(distinct subject_patient_id) as clients_eligible_fws_value\n  from \"airbyte\".\"engage_analytics\".\"clients_eligible_fws\"\n  where 1=1\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by organization_id\n),\nbase_encounters_by_delivery_format as (\n  select\n    current_date as period_date,organization_id,\n    count(distinct case when format_you_deliver = 'In-person' then subject_patient_id end) as encounters_in_person_value,\n    count(distinct case when format_you_deliver = 'Video telehealth' then subject_patient_id end) as encounters_video_telehealth_value,\n    count(distinct case when format_you_deliver = 'Phone telehealth' then subject_patient_id end) as encounters_phone_telehealth_value\n  from \"airbyte\".\"engage_analytics\".\"encounters_by_delivery_format\"\n  where 1=1\n    \n    \n    \n      -- For dimension tables, always use current snapshot\n      and 1=1\n    \n    \n  group by organization_id\n)\n  select\n    period_date,\n    organization_id,\n    'provider_count' as metric_id,\n    provider_count_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Total number of unique providers' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_practitioners\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    practitioner_organization_id,\n    'patient_count' as metric_id,\n    patient_count_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Total number of unique patients' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_patient\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    practitioner_organization_id,\n    'client_encounters' as metric_id,\n    client_encounters_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Total unique clients seen (one encounter per patient per day)' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_encounters\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date >= current_date - interval '7 days'\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'active_providers' as metric_id,\n    active_providers_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Providers who submitted QRs in past 30 days' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_active_providers\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'percent_active_providers' as metric_id,\n    percent_active_providers_value::numeric as value,\n    'percent' as unit,\n    'v1' as method_version,\n    'Percentage of providers active in past 30 days' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_active_providers\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'clients_eligible_for_ipc' as metric_id,\n    clients_eligible_for_ipc_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Clients eligible for IPC (Integrated Primary Care)' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_clients_eligible_for_ipc\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'clients_sbirt_mi_eligible' as metric_id,\n    clients_sbirt_mi_eligible_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Clients eligible for SBIRT/MI (alcohol or drug problems)' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_clients_sbirt_mi_eligible\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'clients_eligible_spi' as metric_id,\n    clients_eligible_spi_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Clients eligible for SPI (Suicide Prevention Intervention)' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_clients_eligible_spi\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'clients_eligible_referral' as metric_id,\n    clients_eligible_referral_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Clients eligible for referral (severe mental health)' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_clients_eligible_referral\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'clients_eligible_fws' as metric_id,\n    clients_eligible_fws_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Clients eligible for FWS (Financial Wellness Services)' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_clients_eligible_fws\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'encounters_in_person' as metric_id,\n    encounters_in_person_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Daily in-person encounters' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_encounters_by_delivery_format\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'encounters_video_telehealth' as metric_id,\n    encounters_video_telehealth_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Daily video telehealth encounters' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_encounters_by_delivery_format\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  union all\n  select\n    period_date,\n    organization_id,\n    'encounters_phone_telehealth' as metric_id,\n    encounters_phone_telehealth_value::numeric as value,\n    'count' as unit,\n    'v1' as method_version,\n    'Daily phone telehealth encounters' as description,\n    'prod' as status,\n    current_timestamp as _last_updated\n  from base_encounters_by_delivery_format\n  \n  \n    -- Only include dates we're updating\n    where 1=1\n    and period_date = current_date\n  \n  \n  ", "relation_name": "\"airbyte\".\"engage_analytics\".\"fct_metrics_long_incremental\"", "batch_results": null}], "elapsed_time": 2.8848319053649902, "args": {"populate_cache": true, "state_modified_compare_more_unrendered_values": false, "log_file_max_bytes": 10485760, "log_format": "default", "strict_mode": false, "require_all_warnings_handled_by_warn_error": false, "which": "run", "show_resource_report": false, "empty": false, "use_colors_file": true, "macro_debugging": false, "print": true, "log_level": "info", "vars": {}, "send_anonymous_usage_stats": true, "use_colors": true, "upload_to_artifacts_ingest_api": false, "printer_width": 80, "warn_error_options": {"error": [], "warn": [], "silence": []}, "state_modified_compare_vars": false, "require_yaml_configuration_for_mf_time_spines": false, "source_freshness_run_project_hooks": true, "static_parser": true, "favor_state": false, "write_json": true, "indirect_selection": "eager", "partial_parse": true, "profiles_dir": ".", "show_all_deprecations": false, "skip_nodes_if_on_run_start_fails": false, "require_nested_cumulative_type_params": false, "invocation_command": "dbt run --profiles-dir . --select fct_metrics_long_incremental", "introspect": true, "use_fast_test_edges": false, "require_generic_test_arguments_property": true, "cache_selected_only": false, "defer": false, "require_explicit_package_overrides_for_builtin_materializations": true, "log_level_file": "debug", "log_format_file": "debug", "partial_parse_file_diff": true, "exclude": [], "version_check": true, "log_path": "/Users/mberg/github/engage-analytics/dbt/logs", "project_dir": "/Users/mberg/github/engage-analytics/dbt", "quiet": false, "select": ["fct_metrics_long_incremental"], "require_batched_execution_for_custom_microbatch_strategy": false, "validate_macro_args": false, "require_resource_names_without_spaces": true}}
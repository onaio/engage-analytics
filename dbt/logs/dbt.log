[0m10:13:36.588277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e843c9f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e843cb5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e843cbf80>]}


============================== 10:13:36.592541 | 33aa59b1-f30c-4d5c-8c5a-825d4aa2b243 ==============================
[0m10:13:36.592541 [info ] [MainThread]: Running with dbt=1.10.9
[0m10:13:36.593247 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'debug': 'False', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'use_experimental_parser': 'False', 'target_path': 'None', 'profiles_dir': '/home/dbt/.dbt', 'warn_error': 'None', 'empty': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'partial_parse': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt deps', 'cache_selected_only': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'use_colors': 'True', 'no_print': 'None', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'static_parser': 'True'}
[0m10:13:36.778954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '33aa59b1-f30c-4d5c-8c5a-825d4aa2b243', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e83d86240>]}
[0m10:13:36.793316 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-rcn63p17'
[0m10:13:36.794141 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m10:13:36.852054 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m10:13:36.854741 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m10:13:36.906535 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m10:13:36.916283 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json
[0m10:13:36.963825 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json 200
[0m10:13:36.980396 [info ] [MainThread]: Updating lock file in file path: /home/dbt/fhir-analytics-repo/engage-analytics/dbt/package-lock.yml
[0m10:13:36.984519 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-vktapo74'
[0m10:13:36.989713 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m10:13:37.080330 [info ] [MainThread]: Installed from version 1.3.0
[0m10:13:37.080902 [info ] [MainThread]: Up to date!
[0m10:13:37.081349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '33aa59b1-f30c-4d5c-8c5a-825d4aa2b243', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e8433e9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e83be4b30>]}
[0m10:13:37.081827 [info ] [MainThread]: Installing dbt-labs/codegen
[0m10:13:37.151128 [info ] [MainThread]: Installed from version 0.13.1
[0m10:13:37.151681 [info ] [MainThread]: Up to date!
[0m10:13:37.152182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '33aa59b1-f30c-4d5c-8c5a-825d4aa2b243', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e85ebc890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e838f2090>]}
[0m10:13:37.155240 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.65917826, "process_in_blocks": "3888", "process_kernel_time": 0.226596, "process_mem_max_rss": "103612", "process_out_blocks": "3088", "process_user_time": 2.33578}
[0m10:13:37.155938 [debug] [MainThread]: Command `dbt deps` succeeded at 10:13:37.155807 after 0.66 seconds
[0m10:13:37.156351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e84003d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e844312b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75e84634e00>]}
[0m10:13:37.156820 [debug] [MainThread]: Flushing usage events
[0m10:13:37.206206 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:43:48.648447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe2965f9394c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe2965fc7e7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe2965fc7f380>]}


============================== 12:43:48.652677 | dfdcd4af-03b5-4303-9f49-f185845c4a04 ==============================
[0m12:43:48.652677 [info ] [MainThread]: Running with dbt=1.10.9
[0m12:43:48.653391 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'printer_width': '80', 'invocation_command': 'dbt debug --project-dir /home/dbt/fhir-analytics-repo/engage-analytics/dbt --profiles-dir /home/dbt/.dbt', 'version_check': 'True', 'log_format': 'default', 'warn_error': 'None', 'static_parser': 'True', 'no_print': 'None', 'empty': 'None', 'profiles_dir': '/home/dbt/.dbt', 'target_path': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'write_json': 'True'}
[0m12:43:48.664147 [info ] [MainThread]: dbt version: 1.10.9
[0m12:43:48.664710 [info ] [MainThread]: python version: 3.12.3
[0m12:43:48.665065 [info ] [MainThread]: python path: /home/dbt/.venvs/dbt/bin/python3
[0m12:43:48.665391 [info ] [MainThread]: os info: Linux-6.14.0-1011-aws-aarch64-with-glibc2.39
[0m12:43:48.665782 [info ] [MainThread]: Using profiles dir at /home/dbt/.dbt
[0m12:43:48.666099 [info ] [MainThread]: Using profiles.yml file at /home/dbt/.dbt/profiles.yml
[0m12:43:48.666408 [info ] [MainThread]: Using dbt_project.yml file at /home/dbt/fhir-analytics-repo/engage-analytics/dbt/dbt_project.yml
[0m12:43:48.837047 [info ] [MainThread]: Configuration:
[0m12:43:48.837636 [info ] [MainThread]:   profiles.yml file [[31mERROR not found[0m]
[0m12:43:48.838017 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:43:48.838352 [info ] [MainThread]: Required dependencies:
[0m12:43:48.838739 [debug] [MainThread]: Executing "git --help"
[0m12:43:48.842134 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:43:48.842741 [debug] [MainThread]: STDERR: "b''"
[0m12:43:48.843077 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:43:48.843453 [info ] [MainThread]: Connection test skipped since no profile was found
[0m12:43:48.843815 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:43:48.844146 [info ] [MainThread]: dbt looked for a profiles.yml file in /home/dbt/.dbt/profiles.yml, but did
not find one. For more information on configuring your profile, consult the
documentation:

https://docs.getdbt.com/docs/configure-your-profile


[0m12:43:48.845227 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.2901169, "process_in_blocks": "0", "process_kernel_time": 0.21309, "process_mem_max_rss": "101804", "process_out_blocks": "16", "process_user_time": 2.050695}
[0m12:43:48.845818 [debug] [MainThread]: Command `dbt debug` failed at 12:43:48.845697 after 0.29 seconds
[0m12:43:48.846227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe2965f54d130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe2965f2a5160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe296621cd700>]}
[0m12:43:48.846706 [debug] [MainThread]: Flushing usage events
[0m12:43:48.897164 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:03:02.194665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef514a1219d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef514853de80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef514853f1a0>]}


============================== 13:03:02.199716 | e6b7240e-85d9-41b9-bd13-692989f68423 ==============================
[0m13:03:02.199716 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:03:02.200521 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'no_print': 'None', 'invocation_command': 'dbt debug --project-dir /home/dbt/fhir-analytics-repo/engage-analytics/dbt --profiles-dir /home/dbt/.dbt', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'log_cache_events': 'False', 'empty': 'None', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'log_format': 'default', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'warn_error': 'None', 'quiet': 'False', 'introspect': 'True', 'profiles_dir': '/home/dbt/.dbt', 'version_check': 'True', 'printer_width': '80', 'fail_fast': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'partial_parse': 'True'}
[0m13:03:02.225941 [info ] [MainThread]: dbt version: 1.10.9
[0m13:03:02.226515 [info ] [MainThread]: python version: 3.12.3
[0m13:03:02.226917 [info ] [MainThread]: python path: /home/dbt/.venvs/dbt/bin/python3
[0m13:03:02.227257 [info ] [MainThread]: os info: Linux-6.14.0-1011-aws-aarch64-with-glibc2.39
[0m13:03:02.227643 [info ] [MainThread]: Using profiles dir at /home/dbt/.dbt
[0m13:03:02.228000 [info ] [MainThread]: Using profiles.yml file at /home/dbt/.dbt/profiles.yml
[0m13:03:02.228332 [info ] [MainThread]: Using dbt_project.yml file at /home/dbt/fhir-analytics-repo/engage-analytics/dbt/dbt_project.yml
[0m13:03:02.406641 [info ] [MainThread]: Configuration:
[0m13:03:02.407266 [info ] [MainThread]:   profiles.yml file [[31mERROR not found[0m]
[0m13:03:02.407681 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:03:02.408031 [info ] [MainThread]: Required dependencies:
[0m13:03:02.408393 [debug] [MainThread]: Executing "git --help"
[0m13:03:02.410821 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:03:02.411388 [debug] [MainThread]: STDERR: "b''"
[0m13:03:02.411765 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:03:02.412137 [info ] [MainThread]: Connection test skipped since no profile was found
[0m13:03:02.412507 [info ] [MainThread]: [31m1 check failed:[0m
[0m13:03:02.412867 [info ] [MainThread]: dbt looked for a profiles.yml file in /home/dbt/.dbt/profiles.yml, but did
not find one. For more information on configuring your profile, consult the
documentation:

https://docs.getdbt.com/docs/configure-your-profile


[0m13:03:02.414002 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.3329806, "process_in_blocks": "2704", "process_kernel_time": 0.246151, "process_mem_max_rss": "101488", "process_out_blocks": "16", "process_user_time": 2.307822}
[0m13:03:02.414636 [debug] [MainThread]: Command `dbt debug` failed at 13:03:02.414501 after 0.33 seconds
[0m13:03:02.415083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef51476e3740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef514941c3e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef51475b8c20>]}
[0m13:03:02.415575 [debug] [MainThread]: Flushing usage events
[0m13:03:02.469099 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:04:03.687714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe26749bd6cc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe26749bd5e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe26749bd7b90>]}


============================== 13:04:03.691982 | f36eb368-f490-4f74-9756-fb7f343d0719 ==============================
[0m13:04:03.691982 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:04:03.692739 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt debug --project-dir /home/dbt/fhir-analytics-repo/engage-analytics/dbt --profiles-dir /home/dbt/.dbt', 'quiet': 'False', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'write_json': 'True', 'target_path': 'None', 'fail_fast': 'False', 'no_print': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'static_parser': 'True', 'use_colors': 'True', 'log_format': 'default', 'debug': 'False', 'printer_width': '80', 'version_check': 'True', 'partial_parse': 'True', 'profiles_dir': '/home/dbt/.dbt'}
[0m13:04:03.703507 [info ] [MainThread]: dbt version: 1.10.9
[0m13:04:03.704066 [info ] [MainThread]: python version: 3.12.3
[0m13:04:03.704480 [info ] [MainThread]: python path: /home/dbt/.venvs/dbt/bin/python3
[0m13:04:03.704856 [info ] [MainThread]: os info: Linux-6.14.0-1011-aws-aarch64-with-glibc2.39
[0m13:04:03.705237 [info ] [MainThread]: Using profiles dir at /home/dbt/.dbt
[0m13:04:03.705609 [info ] [MainThread]: Using profiles.yml file at /home/dbt/.dbt/profiles.yml
[0m13:04:03.705963 [info ] [MainThread]: Using dbt_project.yml file at /home/dbt/fhir-analytics-repo/engage-analytics/dbt/dbt_project.yml
[0m13:04:03.881766 [info ] [MainThread]: Configuration:
[0m13:04:03.882374 [info ] [MainThread]:   profiles.yml file [[31mERROR not found[0m]
[0m13:04:03.882820 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:04:03.883199 [info ] [MainThread]: Required dependencies:
[0m13:04:03.883624 [debug] [MainThread]: Executing "git --help"
[0m13:04:03.885931 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:04:03.886499 [debug] [MainThread]: STDERR: "b''"
[0m13:04:03.886874 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:04:03.887250 [info ] [MainThread]: Connection test skipped since no profile was found
[0m13:04:03.887674 [info ] [MainThread]: [31m1 check failed:[0m
[0m13:04:03.888043 [info ] [MainThread]: dbt looked for a profiles.yml file in /home/dbt/.dbt/profiles.yml, but did
not find one. For more information on configuring your profile, consult the
documentation:

https://docs.getdbt.com/docs/configure-your-profile


[0m13:04:03.889174 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.2935214, "process_in_blocks": "0", "process_kernel_time": 0.203237, "process_mem_max_rss": "101508", "process_out_blocks": "16", "process_user_time": 2.056288}
[0m13:04:03.889768 [debug] [MainThread]: Command `dbt debug` failed at 13:04:03.889644 after 0.29 seconds
[0m13:04:03.890188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe2674a146cc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe26749228cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe26749d9ee70>]}
[0m13:04:03.890685 [debug] [MainThread]: Flushing usage events
[0m13:04:03.944022 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:09:23.765951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xec0da51f0350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xec0da51f2420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xec0da51f3d10>]}


============================== 13:09:23.770074 | 24a7266f-b1cf-4236-bfee-ca36987c499d ==============================
[0m13:09:23.770074 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:09:23.770807 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'empty': 'None', 'invocation_command': 'dbt debug --project-dir /home/dbt/fhir-analytics-repo/engage-analytics/dbt --profiles-dir /home/dbt/.dbt', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'quiet': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'profiles_dir': '/home/dbt/.dbt', 'fail_fast': 'False', 'introspect': 'True', 'static_parser': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'debug': 'False', 'printer_width': '80'}
[0m13:09:23.781110 [info ] [MainThread]: dbt version: 1.10.9
[0m13:09:23.781695 [info ] [MainThread]: python version: 3.12.3
[0m13:09:23.782071 [info ] [MainThread]: python path: /home/dbt/.venvs/dbt/bin/python3
[0m13:09:23.782453 [info ] [MainThread]: os info: Linux-6.14.0-1011-aws-aarch64-with-glibc2.39
[0m13:09:23.782857 [info ] [MainThread]: Using profiles dir at /home/dbt/.dbt
[0m13:09:23.783222 [info ] [MainThread]: Using profiles.yml file at /home/dbt/.dbt/profiles.yml
[0m13:09:23.783632 [info ] [MainThread]: Using dbt_project.yml file at /home/dbt/fhir-analytics-repo/engage-analytics/dbt/dbt_project.yml
[0m13:09:23.956153 [info ] [MainThread]: Configuration:
[0m13:09:23.956772 [info ] [MainThread]:   profiles.yml file [[31mERROR not found[0m]
[0m13:09:23.957176 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:09:23.957562 [info ] [MainThread]: Required dependencies:
[0m13:09:23.957963 [debug] [MainThread]: Executing "git --help"
[0m13:09:23.960168 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:09:23.960682 [debug] [MainThread]: STDERR: "b''"
[0m13:09:23.960998 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:09:23.961347 [info ] [MainThread]: Connection test skipped since no profile was found
[0m13:09:23.961713 [info ] [MainThread]: [31m1 check failed:[0m
[0m13:09:23.962045 [info ] [MainThread]: dbt looked for a profiles.yml file in /home/dbt/.dbt/profiles.yml, but did
not find one. For more information on configuring your profile, consult the
documentation:

https://docs.getdbt.com/docs/configure-your-profile


[0m13:09:23.963214 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.28584993, "process_in_blocks": "0", "process_kernel_time": 0.219086, "process_mem_max_rss": "101500", "process_out_blocks": "16", "process_user_time": 1.973769}
[0m13:09:23.963842 [debug] [MainThread]: Command `dbt debug` failed at 13:09:23.963713 after 0.29 seconds
[0m13:09:23.964312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xec0da5143740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xec0da5926870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xec0da600e480>]}
[0m13:09:23.964809 [debug] [MainThread]: Flushing usage events
[0m13:09:24.017754 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:47:59.299853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75376ba5ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75376be7530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75376be67e0>]}


============================== 13:47:59.303961 | e8febfe8-7f95-4003-a625-44b3031fddef ==============================
[0m13:47:59.303961 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:47:59.304673 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'profiles_dir': '/home/dbt/.dbt', 'invocation_command': 'dbt debug --project-dir /home/dbt/fhir-analytics-repo/engage-analytics/dbt --profiles-dir /home/dbt/.dbt', 'use_colors': 'True', 'cache_selected_only': 'False', 'introspect': 'True', 'warn_error': 'None', 'empty': 'None', 'target_path': 'None', 'use_experimental_parser': 'False', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'static_parser': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'no_print': 'None', 'printer_width': '80', 'write_json': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'debug': 'False'}
[0m13:47:59.315092 [info ] [MainThread]: dbt version: 1.10.9
[0m13:47:59.315695 [info ] [MainThread]: python version: 3.12.3
[0m13:47:59.316072 [info ] [MainThread]: python path: /home/dbt/.venvs/dbt/bin/python3
[0m13:47:59.316431 [info ] [MainThread]: os info: Linux-6.14.0-1011-aws-aarch64-with-glibc2.39
[0m13:47:59.394529 [info ] [MainThread]: Using profiles dir at /home/dbt/.dbt
[0m13:47:59.395104 [info ] [MainThread]: Using profiles.yml file at /home/dbt/.dbt/profiles.yml
[0m13:47:59.395478 [info ] [MainThread]: Using dbt_project.yml file at /home/dbt/fhir-analytics-repo/engage-analytics/dbt/dbt_project.yml
[0m13:47:59.396047 [info ] [MainThread]: adapter type: postgres
[0m13:47:59.396410 [info ] [MainThread]: adapter version: 1.9.0
[0m13:47:59.566189 [info ] [MainThread]: Configuration:
[0m13:47:59.566804 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m13:47:59.567173 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:47:59.567533 [info ] [MainThread]: Required dependencies:
[0m13:47:59.567902 [debug] [MainThread]: Executing "git --help"
[0m13:47:59.570099 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:47:59.570644 [debug] [MainThread]: STDERR: "b''"
[0m13:47:59.570978 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:47:59.571337 [info ] [MainThread]: Connection:
[0m13:47:59.571725 [info ] [MainThread]:   host: omh-engage-production-postgres.cwb4kemo2n2s.us-east-1.rds.amazonaws.com
[0m13:47:59.572059 [info ] [MainThread]:   port: 5432
[0m13:47:59.572377 [info ] [MainThread]:   user: data_warehouse_user
[0m13:47:59.572730 [info ] [MainThread]:   database: data_warehouse
[0m13:47:59.573046 [info ] [MainThread]:   schema: engage_analytics
[0m13:47:59.573359 [info ] [MainThread]:   connect_timeout: 30
[0m13:47:59.573705 [info ] [MainThread]:   role: None
[0m13:47:59.574016 [info ] [MainThread]:   search_path: None
[0m13:47:59.574322 [info ] [MainThread]:   keepalives_idle: 0
[0m13:47:59.574676 [info ] [MainThread]:   sslmode: prefer
[0m13:47:59.574988 [info ] [MainThread]:   sslcert: None
[0m13:47:59.575293 [info ] [MainThread]:   sslkey: None
[0m13:47:59.575635 [info ] [MainThread]:   sslrootcert: None
[0m13:47:59.575943 [info ] [MainThread]:   application_name: dbt
[0m13:47:59.576243 [info ] [MainThread]:   retries: 1
[0m13:47:59.576759 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:47:59.656681 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m13:47:59.683811 [debug] [MainThread]: Using postgres connection "debug"
[0m13:47:59.684338 [debug] [MainThread]: On debug: select 1 as id
[0m13:47:59.684728 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:47:59.717829 [debug] [MainThread]: SQL status: SELECT 1 in 0.033 seconds
[0m13:47:59.719222 [debug] [MainThread]: On debug: Close
[0m13:47:59.719891 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m13:47:59.720443 [info ] [MainThread]: [32mAll checks passed![0m
[0m13:47:59.721591 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.5095776, "process_in_blocks": "3544", "process_kernel_time": 0.243036, "process_mem_max_rss": "113096", "process_out_blocks": "24", "process_user_time": 2.134505}
[0m13:47:59.722161 [debug] [MainThread]: Command `dbt debug` succeeded at 13:47:59.722041 after 0.51 seconds
[0m13:47:59.722557 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m13:47:59.722975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75376654bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe75375613410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe753766e55b0>]}
[0m13:47:59.723455 [debug] [MainThread]: Flushing usage events
[0m13:47:59.774734 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:48:34.169730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b5f9cc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b5b78fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b7e5bda0>]}


============================== 13:48:34.173846 | b779320c-d25b-4b38-b646-e3be3881b705 ==============================
[0m13:48:34.173846 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:48:34.174579 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'printer_width': '80', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'quiet': 'False', 'invocation_command': 'dbt deps --project-dir /home/dbt/fhir-analytics-repo/engage-analytics/dbt --profiles-dir /home/dbt/.dbt', 'empty': 'None', 'write_json': 'True', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'cache_selected_only': 'False', 'no_print': 'None', 'static_parser': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '/home/dbt/.dbt', 'introspect': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'log_format': 'default'}
[0m13:48:34.353222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b779320c-d25b-4b38-b646-e3be3881b705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b4d02f90>]}
[0m13:48:34.380948 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-1ozgoumh'
[0m13:48:34.381543 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m13:48:34.434410 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m13:48:34.436905 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m13:48:34.484402 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m13:48:34.490643 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json
[0m13:48:34.539256 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json 200
[0m13:48:34.543512 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m13:48:34.641635 [info ] [MainThread]: Installed from version 1.3.0
[0m13:48:34.642168 [info ] [MainThread]: Up to date!
[0m13:48:34.642658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'b779320c-d25b-4b38-b646-e3be3881b705', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b5ced580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b5cedf70>]}
[0m13:48:34.643121 [info ] [MainThread]: Installing dbt-labs/codegen
[0m13:48:34.718940 [info ] [MainThread]: Installed from version 0.13.1
[0m13:48:34.719600 [info ] [MainThread]: Up to date!
[0m13:48:34.720176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'b779320c-d25b-4b38-b646-e3be3881b705', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b4aa19d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b4aa1a30>]}
[0m13:48:34.721981 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.6419058, "process_in_blocks": "8", "process_kernel_time": 0.237602, "process_mem_max_rss": "103176", "process_out_blocks": "3080", "process_user_time": 2.270049}
[0m13:48:34.722786 [debug] [MainThread]: Command `dbt deps` succeeded at 13:48:34.722635 after 0.64 seconds
[0m13:48:34.723295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b55973b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b4db39b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8e6b4d01850>]}
[0m13:48:34.723895 [debug] [MainThread]: Flushing usage events
[0m13:48:34.780975 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:48:48.226070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a8a0fbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a8a0ebd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0aadb5820>]}


============================== 13:48:48.230250 | 610d1e8e-09e5-47a9-9841-73c1a97527d2 ==============================
[0m13:48:48.230250 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:48:48.230987 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'quiet': 'False', 'invocation_command': 'dbt build --project-dir /home/dbt/fhir-analytics-repo/engage-analytics/dbt --profiles-dir /home/dbt/.dbt', 'partial_parse': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'log_format': 'default', 'debug': 'False', 'write_json': 'True', 'static_parser': 'True', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'introspect': 'True', 'empty': 'False', 'no_print': 'None', 'target_path': 'None', 'profiles_dir': '/home/dbt/.dbt', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None'}
[0m13:48:48.485997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a800af90>]}
[0m13:48:48.593540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a74ff590>]}
[0m13:48:48.594586 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:48:48.698212 [debug] [MainThread]: checksum: 2980a21a4fc584f27f03453e4d43c980470d5de79693c5ce0bc2b462a52f088e, vars: {}, profile: , target: prod, version: 1.10.9
[0m13:48:48.699173 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m13:48:48.699774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a7f3c620>]}
[0m13:48:50.677161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a6fb4e30>]}
[0m13:48:50.775237 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m13:48:50.777661 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m13:48:50.812551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a68fb4d0>]}
[0m13:48:50.813211 [info ] [MainThread]: Found 12 models, 1 seed, 11 sources, 575 macros
[0m13:48:50.816464 [info ] [MainThread]: 
[0m13:48:50.817017 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m13:48:50.817408 [info ] [MainThread]: 
[0m13:48:50.818067 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:48:50.823733 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m13:48:50.824522 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m13:48:50.825256 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m13:48:50.836502 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m13:48:50.993200 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m13:48:50.993749 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m13:48:50.994255 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m13:48:50.994673 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m13:48:50.995076 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m13:48:50.995553 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m13:48:50.995988 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m13:48:50.996409 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:48:50.996851 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m13:48:50.997252 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:48:50.997662 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:48:50.998292 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:48:51.027776 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.030 seconds
[0m13:48:51.028821 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.031 seconds
[0m13:48:51.028371 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.032 seconds
[0m13:48:51.030756 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m13:48:51.031488 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.033 seconds
[0m13:48:51.033241 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m13:48:51.034990 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m13:48:51.036846 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m13:48:51.038963 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now create_data_warehouse_engage_analytics_mart)
[0m13:48:51.039525 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now create_data_warehouse_engage_analytics_int)
[0m13:48:51.040173 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now create_data_warehouse_engage_analytics_stg)
[0m13:48:51.040780 [debug] [ThreadPool]: Creating schema "database: "data_warehouse"
schema: "engage_analytics_mart"
"
[0m13:48:51.041276 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now create_data_warehouse_engage_analytics)
[0m13:48:51.042015 [debug] [ThreadPool]: Creating schema "database: "data_warehouse"
schema: "engage_analytics_int"
"
[0m13:48:51.042690 [debug] [ThreadPool]: Creating schema "database: "data_warehouse"
schema: "engage_analytics_stg"
"
[0m13:48:51.050348 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_mart"
[0m13:48:51.051148 [debug] [ThreadPool]: Creating schema "database: "data_warehouse"
schema: "engage_analytics"
"
[0m13:48:51.053831 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_int"
[0m13:48:51.056742 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_stg"
[0m13:48:51.057338 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_mart: BEGIN
[0m13:48:51.062865 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics"
[0m13:48:51.063497 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_int: BEGIN
[0m13:48:51.063990 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_stg: BEGIN
[0m13:48:51.064493 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:51.064943 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics: BEGIN
[0m13:48:51.065367 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:51.065863 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:51.066724 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:51.087292 [debug] [ThreadPool]: SQL status: BEGIN in 0.022 seconds
[0m13:48:51.087876 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_int"
[0m13:48:51.088248 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_int: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "create_data_warehouse_engage_analytics_int"} */
create schema if not exists "engage_analytics_int"
[0m13:48:51.089150 [debug] [ThreadPool]: SQL status: BEGIN in 0.023 seconds
[0m13:48:51.089589 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_stg"
[0m13:48:51.089967 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_stg: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "create_data_warehouse_engage_analytics_stg"} */
create schema if not exists "engage_analytics_stg"
[0m13:48:51.092132 [debug] [ThreadPool]: SQL status: BEGIN in 0.025 seconds
[0m13:48:51.092635 [debug] [ThreadPool]: SQL status: BEGIN in 0.028 seconds
[0m13:48:51.093086 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.004 seconds
[0m13:48:51.093515 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics"
[0m13:48:51.094044 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.004 seconds
[0m13:48:51.094471 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_mart"
[0m13:48:51.095832 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_int: COMMIT
[0m13:48:51.096312 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "create_data_warehouse_engage_analytics"} */
create schema if not exists "engage_analytics"
[0m13:48:51.097606 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_stg: COMMIT
[0m13:48:51.098094 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_mart: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "create_data_warehouse_engage_analytics_mart"} */
create schema if not exists "engage_analytics_mart"
[0m13:48:51.098571 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_int"
[0m13:48:51.099130 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_stg"
[0m13:48:51.099662 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_int: COMMIT
[0m13:48:51.100136 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_stg: COMMIT
[0m13:48:51.100536 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.002 seconds
[0m13:48:51.100910 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:48:51.102501 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics: COMMIT
[0m13:48:51.103057 [debug] [ThreadPool]: SQL status: COMMIT in 0.002 seconds
[0m13:48:51.103481 [debug] [ThreadPool]: SQL status: COMMIT in 0.002 seconds
[0m13:48:51.104766 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_mart: COMMIT
[0m13:48:51.105317 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics"
[0m13:48:51.105818 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_int: Close
[0m13:48:51.106319 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_stg: Close
[0m13:48:51.106843 [debug] [ThreadPool]: Using postgres connection "create_data_warehouse_engage_analytics_mart"
[0m13:48:51.107273 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics: COMMIT
[0m13:48:51.108711 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_mart: COMMIT
[0m13:48:51.110444 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:48:51.110903 [debug] [ThreadPool]: SQL status: COMMIT in 0.002 seconds
[0m13:48:51.111412 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics_mart: Close
[0m13:48:51.111919 [debug] [ThreadPool]: On create_data_warehouse_engage_analytics: Close
[0m13:48:51.115105 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_data_warehouse_engage_analytics, now list_data_warehouse_engage_analytics_mart)
[0m13:48:51.115921 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_data_warehouse_engage_analytics_mart, now list_data_warehouse_engage_analytics_int)
[0m13:48:51.116684 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_data_warehouse_engage_analytics_int, now list_data_warehouse_engage_analytics_stg)
[0m13:48:51.122631 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_data_warehouse_engage_analytics_stg, now list_data_warehouse_engage_analytics)
[0m13:48:51.125630 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m13:48:51.128622 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m13:48:51.131476 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m13:48:51.134110 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m13:48:51.134692 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: BEGIN
[0m13:48:51.135153 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: BEGIN
[0m13:48:51.135663 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: BEGIN
[0m13:48:51.136094 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: BEGIN
[0m13:48:51.136530 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:51.136947 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:51.137377 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:51.137823 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:51.159605 [debug] [ThreadPool]: SQL status: BEGIN in 0.022 seconds
[0m13:48:51.160145 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m13:48:51.160540 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics'
  
[0m13:48:51.161146 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m13:48:51.161566 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m13:48:51.161919 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_stg"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_stg'
  
[0m13:48:51.163179 [debug] [ThreadPool]: SQL status: BEGIN in 0.027 seconds
[0m13:48:51.163630 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m13:48:51.163998 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_mart"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_mart'
  
[0m13:48:51.164920 [debug] [ThreadPool]: SQL status: BEGIN in 0.028 seconds
[0m13:48:51.165308 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m13:48:51.165709 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_int"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_int'
  
[0m13:48:51.166241 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m13:48:51.167936 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: ROLLBACK
[0m13:48:51.168533 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:48:51.168974 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.007 seconds
[0m13:48:51.170725 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: ROLLBACK
[0m13:48:51.171179 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: Close
[0m13:48:51.171636 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m13:48:51.173159 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: ROLLBACK
[0m13:48:51.175165 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: ROLLBACK
[0m13:48:51.175914 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: Close
[0m13:48:51.176900 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: Close
[0m13:48:51.177315 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: Close
[0m13:48:51.184402 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:51.184952 [debug] [MainThread]: On master: BEGIN
[0m13:48:51.185265 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:48:51.200289 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m13:48:51.200834 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:51.201264 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:48:51.222057 [debug] [MainThread]: SQL status: SELECT 0 in 0.020 seconds
[0m13:48:51.223750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a44790d0>]}
[0m13:48:51.224378 [debug] [MainThread]: On master: ROLLBACK
[0m13:48:51.225220 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:51.225629 [debug] [MainThread]: On master: BEGIN
[0m13:48:51.226579 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:48:51.226977 [debug] [MainThread]: On master: COMMIT
[0m13:48:51.227301 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:51.227644 [debug] [MainThread]: On master: COMMIT
[0m13:48:51.228280 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:48:51.228672 [debug] [MainThread]: On master: Close
[0m13:48:51.233355 [debug] [Thread-1 (]: Began running node model.opensrp_mh.stg_encounter
[0m13:48:51.233985 [debug] [Thread-2 (]: Began running node model.opensrp_mh.stg_patient
[0m13:48:51.234595 [debug] [Thread-3 (]: Began running node model.opensrp_mh.stg_practitioner
[0m13:48:51.235732 [debug] [Thread-4 (]: Began running node model.opensrp_mh.stg_questionnaire_response
[0m13:48:51.235262 [info ] [Thread-1 (]: 1 of 13 START sql view model engage_analytics_stg.stg_encounter ................ [RUN]
[0m13:48:51.236600 [info ] [Thread-2 (]: 2 of 13 START sql view model engage_analytics_stg.stg_patient .................. [RUN]
[0m13:48:51.237390 [info ] [Thread-3 (]: 3 of 13 START sql view model engage_analytics_stg.stg_practitioner ............. [RUN]
[0m13:48:51.238757 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_stg, now model.opensrp_mh.stg_encounter)
[0m13:48:51.240650 [debug] [Thread-1 (]: Began compiling node model.opensrp_mh.stg_encounter
[0m13:48:51.238129 [info ] [Thread-4 (]: 4 of 13 START sql view model engage_analytics_stg.stg_questionnaire_response ... [RUN]
[0m13:48:51.240072 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_int, now model.opensrp_mh.stg_practitioner)
[0m13:48:51.239338 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_mart, now model.opensrp_mh.stg_patient)
[0m13:48:51.251058 [debug] [Thread-1 (]: Writing injected SQL for node "model.opensrp_mh.stg_encounter"
[0m13:48:51.251824 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics, now model.opensrp_mh.stg_questionnaire_response)
[0m13:48:51.252378 [debug] [Thread-3 (]: Began compiling node model.opensrp_mh.stg_practitioner
[0m13:48:51.252907 [debug] [Thread-2 (]: Began compiling node model.opensrp_mh.stg_patient
[0m13:48:51.253614 [debug] [Thread-4 (]: Began compiling node model.opensrp_mh.stg_questionnaire_response
[0m13:48:51.257773 [debug] [Thread-3 (]: Writing injected SQL for node "model.opensrp_mh.stg_practitioner"
[0m13:48:51.261994 [debug] [Thread-2 (]: Writing injected SQL for node "model.opensrp_mh.stg_patient"
[0m13:48:51.267106 [debug] [Thread-4 (]: Writing injected SQL for node "model.opensrp_mh.stg_questionnaire_response"
[0m13:48:51.268015 [debug] [Thread-1 (]: Began executing node model.opensrp_mh.stg_encounter
[0m13:48:51.268598 [debug] [Thread-3 (]: Began executing node model.opensrp_mh.stg_practitioner
[0m13:48:51.279895 [debug] [Thread-4 (]: Began executing node model.opensrp_mh.stg_questionnaire_response
[0m13:48:51.280552 [debug] [Thread-2 (]: Began executing node model.opensrp_mh.stg_patient
[0m13:48:51.361168 [debug] [Thread-4 (]: Writing runtime sql for node "model.opensrp_mh.stg_questionnaire_response"
[0m13:48:51.360542 [debug] [Thread-1 (]: Writing runtime sql for node "model.opensrp_mh.stg_encounter"
[0m13:48:51.367289 [debug] [Thread-3 (]: Writing runtime sql for node "model.opensrp_mh.stg_practitioner"
[0m13:48:51.371536 [debug] [Thread-2 (]: Writing runtime sql for node "model.opensrp_mh.stg_patient"
[0m13:48:51.373090 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m13:48:51.373822 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m13:48:51.374565 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m13:48:51.375111 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: BEGIN
[0m13:48:51.375612 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m13:48:51.376121 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: BEGIN
[0m13:48:51.376641 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: BEGIN
[0m13:48:51.377140 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:48:51.377640 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: BEGIN
[0m13:48:51.378162 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:48:51.378710 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:48:51.379380 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:48:51.400292 [debug] [Thread-4 (]: SQL status: BEGIN in 0.022 seconds
[0m13:48:51.400946 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m13:48:51.401450 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_tmp"
    
    
  as (
    with base as (
    select
        id as fhir_id,
        resource,
        resource ->> 'id'                          as resource_id,
        resource ->> 'status'                      as status,
        resource ->> 'questionnaire'               as questionnaire_canonical,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'subject' ->> 'reference', '^\w+/', ''))
    as patient_id,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'encounter' ->> 'reference', '^\w+/', ''))
  as encounter_id,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'author' ->> 'reference', '^\w+/', ''))
     as author_id,
        
    -- Handle ISO strings from FHIR meta/fields safely
    (resource ->> 'authored'::timestamptz)
 as authored_ts,
        
    -- Handle ISO strings from FHIR meta/fields safely
    (lastUpdated::timestamptz)
        as lastUpdated_ts,
        _airbyte_extracted_at
    from "data_warehouse"."airbyte"."questionnaire_response"
)
select * from base;
  );
[0m13:48:51.401966 [debug] [Thread-3 (]: SQL status: BEGIN in 0.023 seconds
[0m13:48:51.402729 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m13:48:51.403214 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_tmp"
    
    
  as (
    select
    id as fhir_id,
    resource,
    resource ->> 'id'                            as resource_id,
    resource -> 'name' -> 0 ->> 'family'         as family_name,
    resource -> 'name' -> 0 -> 'given' ->> 0     as given_name,
    resource -> 'telecom' -> 0 ->> 'value'       as phone_raw,
    
    -- Handle ISO strings from FHIR meta/fields safely
    (lastUpdated::timestamptz)
          as lastUpdated_ts,
    _airbyte_extracted_at
from "data_warehouse"."airbyte"."practitioner";
  );
[0m13:48:51.403820 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 37: select * from base;
                           ^

[0m13:48:51.404565 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: ROLLBACK
[0m13:48:51.405152 [debug] [Thread-2 (]: SQL status: BEGIN in 0.026 seconds
[0m13:48:51.405667 [debug] [Thread-1 (]: SQL status: BEGIN in 0.029 seconds
[0m13:48:51.406237 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 19: from "data_warehouse"."airbyte"."practitioner";
                                                       ^

[0m13:48:51.406886 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m13:48:51.407500 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m13:48:51.408106 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: Close
[0m13:48:51.408634 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: ROLLBACK
[0m13:48:51.409176 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_tmp"
    
    
  as (
    with src as (
    select
        id as fhir_id,
        resource,
        resource ->> 'id'                  as resource_id,
        resource -> 'meta' ->> 'versionId' as version_id,
        resource -> 'meta' ->> 'lastUpdated' as meta_last_updated,
        resource ->> 'gender'              as gender,
        resource ->> 'birthDate'           as birth_date,
        resource ->> 'active'              as active,
        
    -- Handle ISO strings from FHIR meta/fields safely
    (lastUpdated::timestamptz)
 as lastUpdated_ts,
        _airbyte_extracted_at
    from "data_warehouse"."airbyte"."patient"
)
select * from src;
  );
[0m13:48:51.409791 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_encounter"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_encounter__dbt_tmp"
    
    
  as (
    select
    id as fhir_id,
    resource,
    resource ->> 'id'                                 as resource_id,
    resource ->> 'status'                             as status,
    resource -> 'class' ->> 'code'                    as class_code,
    resource -> 'type'  -> 0 -> 'coding' -> 0 ->> 'code' as type_code,
    resource -> 'type'  -> 0 -> 'coding' -> 0 ->> 'display' as type_display,
    
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'subject' ->> 'reference', '^\w+/', ''))
 as patient_id,
    
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'participant' -> 0 -> 'individual' ->> 'reference', '^\w+/', ''))
 as practitioner_id,
    
    -- Handle ISO strings from FHIR meta/fields safely
    (resource ->> 'period' ->> 'start'::timestamptz)
 as period_start,
    
    -- Handle ISO strings from FHIR meta/fields safely
    (resource ->> 'period' ->> 'end'::timestamptz)
   as period_end,
    
    -- Handle ISO strings from FHIR meta/fields safely
    (lastUpdated::timestamptz)
                       as lastUpdated_ts,
    _airbyte_extracted_at
from "data_warehouse"."airbyte"."encounter";
  );
[0m13:48:51.412083 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 24: select * from src;
                          ^

[0m13:48:51.414911 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: ROLLBACK
[0m13:48:51.414177 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 36: from "data_warehouse"."airbyte"."encounter";
                                                    ^

[0m13:48:51.413615 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: Close
[0m13:48:51.416463 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: Close
[0m13:48:51.416946 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: ROLLBACK
[0m13:48:51.422940 [debug] [Thread-4 (]: Database Error in model stg_questionnaire_response (models/staging/stg_questionnaire_response.sql)
  syntax error at or near ";"
  LINE 37: select * from base;
                             ^
  compiled code at target/run/opensrp_mh/models/staging/stg_questionnaire_response.sql
[0m13:48:51.425342 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: Close
[0m13:48:51.427290 [debug] [Thread-2 (]: Database Error in model stg_patient (models/staging/stg_patient.sql)
  syntax error at or near ";"
  LINE 24: select * from src;
                            ^
  compiled code at target/run/opensrp_mh/models/staging/stg_patient.sql
[0m13:48:51.429333 [debug] [Thread-3 (]: Database Error in model stg_practitioner (models/staging/stg_practitioner.sql)
  syntax error at or near ";"
  LINE 19: from "data_warehouse"."airbyte"."practitioner";
                                                         ^
  compiled code at target/run/opensrp_mh/models/staging/stg_practitioner.sql
[0m13:48:51.431250 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a6a2b260>]}
[0m13:48:51.432959 [debug] [Thread-1 (]: Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  syntax error at or near ";"
  LINE 36: from "data_warehouse"."airbyte"."encounter";
                                                      ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql
[0m13:48:51.433670 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a68e8e60>]}
[0m13:48:51.434264 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a45e7aa0>]}
[0m13:48:51.435768 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a69c5cd0>]}
[0m13:48:51.435167 [error] [Thread-4 (]: 4 of 13 ERROR creating sql view model engage_analytics_stg.stg_questionnaire_response  [[31mERROR[0m in 0.17s]
[0m13:48:51.436830 [error] [Thread-2 (]: 2 of 13 ERROR creating sql view model engage_analytics_stg.stg_patient ......... [[31mERROR[0m in 0.19s]
[0m13:48:51.437616 [error] [Thread-3 (]: 3 of 13 ERROR creating sql view model engage_analytics_stg.stg_practitioner .... [[31mERROR[0m in 0.19s]
[0m13:48:51.438662 [error] [Thread-1 (]: 1 of 13 ERROR creating sql view model engage_analytics_stg.stg_encounter ....... [[31mERROR[0m in 0.20s]
[0m13:48:51.439576 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.stg_questionnaire_response
[0m13:48:51.440251 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.stg_patient
[0m13:48:51.440909 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.stg_practitioner
[0m13:48:51.441655 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.stg_encounter
[0m13:48:51.442236 [debug] [Thread-4 (]: Began running node seed.opensrp_mh.score_map
[0m13:48:51.442968 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_questionnaire_response' to be skipped because of status 'error'.  Reason: Database Error in model stg_questionnaire_response (models/staging/stg_questionnaire_response.sql)
  syntax error at or near ";"
  LINE 37: select * from base;
                             ^
  compiled code at target/run/opensrp_mh/models/staging/stg_questionnaire_response.sql.
[0m13:48:51.445089 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_patient' to be skipped because of status 'error'.  Reason: Database Error in model stg_patient (models/staging/stg_patient.sql)
  syntax error at or near ";"
  LINE 24: select * from src;
                            ^
  compiled code at target/run/opensrp_mh/models/staging/stg_patient.sql.
[0m13:48:51.443968 [info ] [Thread-4 (]: 5 of 13 START seed file engage_analytics.score_map ............................. [RUN]
[0m13:48:51.446049 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_practitioner' to be skipped because of status 'error'.  Reason: Database Error in model stg_practitioner (models/staging/stg_practitioner.sql)
  syntax error at or near ";"
  LINE 19: from "data_warehouse"."airbyte"."practitioner";
                                                         ^
  compiled code at target/run/opensrp_mh/models/staging/stg_practitioner.sql.
[0m13:48:51.446622 [debug] [Thread-2 (]: Began running node model.opensrp_mh.int_qr_answers_long
[0m13:48:51.447641 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_questionnaire_response, now seed.opensrp_mh.score_map)
[0m13:48:51.447138 [debug] [Thread-1 (]: Began running node model.opensrp_mh.dim_patient
[0m13:48:51.448339 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_encounter' to be skipped because of status 'error'.  Reason: Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  syntax error at or near ";"
  LINE 36: from "data_warehouse"."airbyte"."encounter";
                                                      ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql.
[0m13:48:51.449526 [debug] [Thread-3 (]: Began running node model.opensrp_mh.dim_practitioner
[0m13:48:51.449031 [info ] [Thread-2 (]: 6 of 13 SKIP relation engage_analytics_int.int_qr_answers_long ................. [[33mSKIP[0m]
[0m13:48:51.450185 [debug] [Thread-4 (]: Began compiling node seed.opensrp_mh.score_map
[0m13:48:51.450770 [info ] [Thread-1 (]: 7 of 13 SKIP relation engage_analytics_mart.dim_patient ........................ [[33mSKIP[0m]
[0m13:48:51.451571 [info ] [Thread-3 (]: 8 of 13 SKIP relation engage_analytics_mart.dim_practitioner ................... [[33mSKIP[0m]
[0m13:48:51.452327 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.int_qr_answers_long
[0m13:48:51.452914 [debug] [Thread-4 (]: Began executing node seed.opensrp_mh.score_map
[0m13:48:51.453458 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.dim_patient
[0m13:48:51.453976 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.dim_practitioner
[0m13:48:51.454585 [debug] [Thread-2 (]: Began running node model.opensrp_mh.fact_encounter
[0m13:48:51.455034 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.int_qr_answers_long' to be skipped because of status 'skipped'. 
[0m13:48:51.485908 [debug] [Thread-4 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m13:48:51.486746 [info ] [Thread-2 (]: 9 of 13 SKIP relation engage_analytics_mart.fact_encounter ..................... [[33mSKIP[0m]
[0m13:48:51.487540 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.dim_patient' to be skipped because of status 'skipped'. 
[0m13:48:51.488201 [debug] [Thread-4 (]: On seed.opensrp_mh.score_map: BEGIN
[0m13:48:51.488717 [debug] [Thread-1 (]: Began running node model.opensrp_mh.fact_qr_latest_scores
[0m13:48:51.489261 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.fact_encounter
[0m13:48:51.489811 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.dim_practitioner' to be skipped because of status 'skipped'. 
[0m13:48:51.490292 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:48:51.491489 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.fact_encounter' to be skipped because of status 'skipped'. 
[0m13:48:51.490866 [info ] [Thread-1 (]: 10 of 13 SKIP relation engage_analytics_mart.fact_qr_latest_scores ............. [[33mSKIP[0m]
[0m13:48:51.492633 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.fact_qr_latest_scores
[0m13:48:51.493302 [debug] [Thread-3 (]: Began running node model.opensrp_mh.core_counts
[0m13:48:51.493854 [debug] [Thread-2 (]: Began running node model.opensrp_mh.patients_no_followup
[0m13:48:51.494390 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.fact_qr_latest_scores' to be skipped because of status 'skipped'. 
[0m13:48:51.494912 [info ] [Thread-3 (]: 11 of 13 SKIP relation engage_analytics_mart.core_counts ....................... [[33mSKIP[0m]
[0m13:48:51.495581 [info ] [Thread-2 (]: 12 of 13 SKIP relation engage_analytics_mart.patients_no_followup .............. [[33mSKIP[0m]
[0m13:48:51.496628 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.core_counts
[0m13:48:51.497171 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.patients_no_followup
[0m13:48:51.497688 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.core_counts' to be skipped because of status 'skipped'. 
[0m13:48:51.498214 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.patients_no_followup' to be skipped because of status 'skipped'. 
[0m13:48:51.508605 [debug] [Thread-4 (]: SQL status: BEGIN in 0.018 seconds
[0m13:48:51.509179 [debug] [Thread-4 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m13:48:51.509630 [debug] [Thread-4 (]: On seed.opensrp_mh.score_map: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "seed.opensrp_mh.score_map"} */

    create table "data_warehouse"."engage_analytics"."score_map" ("questionnaire_match" text,"link_id" text,"coding_code" integer,"numeric_value" integer)
  
[0m13:48:51.517006 [debug] [Thread-4 (]: SQL status: CREATE TABLE in 0.007 seconds
[0m13:48:51.536929 [debug] [Thread-4 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m13:48:51.537514 [debug] [Thread-4 (]: On seed.opensrp_mh.score_map: 
          insert into "data_warehouse"."engage_analytics"."score_map" ("questionnaire_match", "link_id", "coding_code", "numeric_value") values
          (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m13:48:51.539660 [debug] [Thread-4 (]: SQL status: INSERT 0 4 in 0.002 seconds
[0m13:48:51.549336 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.opensrp_mh.score_map"
[0m13:48:51.571234 [debug] [Thread-4 (]: On seed.opensrp_mh.score_map: COMMIT
[0m13:48:51.571859 [debug] [Thread-4 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m13:48:51.572267 [debug] [Thread-4 (]: On seed.opensrp_mh.score_map: COMMIT
[0m13:48:51.573897 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m13:48:51.576183 [debug] [Thread-4 (]: On seed.opensrp_mh.score_map: Close
[0m13:48:51.577178 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '610d1e8e-09e5-47a9-9841-73c1a97527d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a4313740>]}
[0m13:48:51.577875 [info ] [Thread-4 (]: 5 of 13 OK loaded seed file engage_analytics.score_map ......................... [[32mINSERT 4[0m in 0.13s]
[0m13:48:51.578594 [debug] [Thread-4 (]: Finished running node seed.opensrp_mh.score_map
[0m13:48:51.579466 [debug] [Thread-1 (]: Began running node model.opensrp_mh.int_qr_answers_scored
[0m13:48:51.580176 [info ] [Thread-1 (]: 13 of 13 SKIP relation engage_analytics_int.int_qr_answers_scored .............. [[33mSKIP[0m]
[0m13:48:51.580729 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.int_qr_answers_scored
[0m13:48:51.581172 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.int_qr_answers_scored' to be skipped because of status 'skipped'. 
[0m13:48:51.582900 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:51.583268 [debug] [MainThread]: On master: BEGIN
[0m13:48:51.583602 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:48:51.598901 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m13:48:51.599481 [debug] [MainThread]: On master: COMMIT
[0m13:48:51.599858 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:51.600172 [debug] [MainThread]: On master: COMMIT
[0m13:48:51.600871 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:48:51.601275 [debug] [MainThread]: On master: Close
[0m13:48:51.602007 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:48:51.602398 [debug] [MainThread]: Connection 'seed.opensrp_mh.score_map' was properly closed.
[0m13:48:51.602750 [debug] [MainThread]: Connection 'model.opensrp_mh.stg_encounter' was properly closed.
[0m13:48:51.603038 [debug] [MainThread]: Connection 'model.opensrp_mh.stg_practitioner' was properly closed.
[0m13:48:51.603324 [debug] [MainThread]: Connection 'model.opensrp_mh.stg_patient' was properly closed.
[0m13:48:51.603819 [info ] [MainThread]: 
[0m13:48:51.604295 [info ] [MainThread]: Finished running 1 seed, 12 view models in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m13:48:51.606026 [debug] [MainThread]: Command end result
[0m13:48:51.640024 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m13:48:51.642747 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m13:48:51.650011 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/run_results.json
[0m13:48:51.650520 [info ] [MainThread]: 
[0m13:48:51.651067 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m13:48:51.651592 [info ] [MainThread]: 
[0m13:48:51.652134 [error] [MainThread]: [31mFailure in model stg_questionnaire_response (models/staging/stg_questionnaire_response.sql)[0m
[0m13:48:51.652661 [error] [MainThread]:   Database Error in model stg_questionnaire_response (models/staging/stg_questionnaire_response.sql)
  syntax error at or near ";"
  LINE 37: select * from base;
                             ^
  compiled code at target/run/opensrp_mh/models/staging/stg_questionnaire_response.sql
[0m13:48:51.653077 [info ] [MainThread]: 
[0m13:48:51.653579 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_questionnaire_response.sql
[0m13:48:51.654009 [info ] [MainThread]: 
[0m13:48:51.654511 [error] [MainThread]: [31mFailure in model stg_patient (models/staging/stg_patient.sql)[0m
[0m13:48:51.655020 [error] [MainThread]:   Database Error in model stg_patient (models/staging/stg_patient.sql)
  syntax error at or near ";"
  LINE 24: select * from src;
                            ^
  compiled code at target/run/opensrp_mh/models/staging/stg_patient.sql
[0m13:48:51.655459 [info ] [MainThread]: 
[0m13:48:51.655925 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_patient.sql
[0m13:48:51.656336 [info ] [MainThread]: 
[0m13:48:51.656827 [error] [MainThread]: [31mFailure in model stg_practitioner (models/staging/stg_practitioner.sql)[0m
[0m13:48:51.657301 [error] [MainThread]:   Database Error in model stg_practitioner (models/staging/stg_practitioner.sql)
  syntax error at or near ";"
  LINE 19: from "data_warehouse"."airbyte"."practitioner";
                                                         ^
  compiled code at target/run/opensrp_mh/models/staging/stg_practitioner.sql
[0m13:48:51.657715 [info ] [MainThread]: 
[0m13:48:51.658172 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_practitioner.sql
[0m13:48:51.658632 [info ] [MainThread]: 
[0m13:48:51.659105 [error] [MainThread]: [31mFailure in model stg_encounter (models/staging/stg_encounter.sql)[0m
[0m13:48:51.659595 [error] [MainThread]:   Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  syntax error at or near ";"
  LINE 36: from "data_warehouse"."airbyte"."encounter";
                                                      ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql
[0m13:48:51.659996 [info ] [MainThread]: 
[0m13:48:51.660475 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_encounter.sql
[0m13:48:51.660926 [info ] [MainThread]: 
[0m13:48:51.661369 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=4 SKIP=8 NO-OP=0 TOTAL=13
[0m13:48:51.662581 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 3.5255148, "process_in_blocks": "3224", "process_kernel_time": 0.313719, "process_mem_max_rss": "132736", "process_out_blocks": "4040", "process_user_time": 5.002381}
[0m13:48:51.663125 [debug] [MainThread]: Command `dbt build` failed at 13:48:51.663016 after 3.53 seconds
[0m13:48:51.663560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a8103c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a86c78c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe8d0a80a9340>]}
[0m13:48:51.663995 [debug] [MainThread]: Flushing usage events
[0m13:48:51.718248 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:55:28.918348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf857c90a2240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf857c97f9c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf857c97f9340>]}


============================== 13:55:28.922627 | 9d402b8c-3783-4d0e-a0eb-1e355f05a5d3 ==============================
[0m13:55:28.922627 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:55:28.923361 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt clean', 'version_check': 'True', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'target_path': 'None', 'printer_width': '80', 'use_colors': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'empty': 'None', 'use_experimental_parser': 'False', 'debug': 'False', 'introspect': 'True', 'profiles_dir': '/home/dbt/.dbt', 'warn_error': 'None', 'no_print': 'None', 'static_parser': 'True', 'write_json': 'True', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:55:29.103000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d402b8c-3783-4d0e-a0eb-1e355f05a5d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf857c88bf410>]}
[0m13:55:29.115226 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.2837246, "process_in_blocks": "0", "process_kernel_time": 0.216056, "process_mem_max_rss": "101604", "process_out_blocks": "8", "process_user_time": 1.958595}
[0m13:55:29.115799 [debug] [MainThread]: Command `dbt clean` succeeded at 13:55:29.115684 after 0.28 seconds
[0m13:55:29.116190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf857c88bf410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf857c916e7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf857c97f9c40>]}
[0m13:55:29.116614 [debug] [MainThread]: Flushing usage events
[0m13:55:29.168817 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:55:43.388697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412c446ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412c1d1970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412c20f110>]}


============================== 13:55:43.392843 | 90f5753b-73f9-4b90-a09f-e4dbfa524bab ==============================
[0m13:55:43.392843 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:55:43.393549 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt deps', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'quiet': 'False', 'introspect': 'True', 'printer_width': '80', 'static_parser': 'True', 'log_format': 'default', 'version_check': 'True', 'partial_parse': 'True', 'debug': 'False', 'profiles_dir': '/home/dbt/.dbt', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'no_print': 'None'}
[0m13:55:43.573115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '90f5753b-73f9-4b90-a09f-e4dbfa524bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412ba7af90>]}
[0m13:55:43.600659 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-qt_q8clm'
[0m13:55:43.601229 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m13:55:43.655786 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m13:55:43.658269 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m13:55:43.708195 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m13:55:43.714519 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json
[0m13:55:43.761904 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json 200
[0m13:55:43.766016 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m13:55:43.857799 [info ] [MainThread]: Installed from version 1.3.0
[0m13:55:43.858344 [info ] [MainThread]: Up to date!
[0m13:55:43.858858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '90f5753b-73f9-4b90-a09f-e4dbfa524bab', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412b6fbcb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412b6fb8c0>]}
[0m13:55:43.859347 [info ] [MainThread]: Installing dbt-labs/codegen
[0m13:55:43.926730 [info ] [MainThread]: Installed from version 0.13.1
[0m13:55:43.927268 [info ] [MainThread]: Up to date!
[0m13:55:43.927754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '90f5753b-73f9-4b90-a09f-e4dbfa524bab', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412c967e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412b6fb8c0>]}
[0m13:55:43.929170 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.6275617, "process_in_blocks": "0", "process_kernel_time": 0.230079, "process_mem_max_rss": "103328", "process_out_blocks": "3080", "process_user_time": 2.292745}
[0m13:55:43.929787 [debug] [MainThread]: Command `dbt deps` succeeded at 13:55:43.929663 after 0.63 seconds
[0m13:55:43.930193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412ba977a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412c11be30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfd412be4e960>]}
[0m13:55:43.930658 [debug] [MainThread]: Flushing usage events
[0m13:55:43.980517 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:55:54.788110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c415e540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c22811f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c2283da0>]}


============================== 13:55:54.792253 | a483f185-88c2-4ac1-970a-6a736435334b ==============================
[0m13:55:54.792253 [info ] [MainThread]: Running with dbt=1.10.9
[0m13:55:54.792983 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'log_format': 'default', 'debug': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'invocation_command': 'dbt build', 'introspect': 'True', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'empty': 'False', 'no_print': 'None', 'version_check': 'True', 'partial_parse': 'True', 'target_path': 'None', 'warn_error': 'None', 'indirect_selection': 'eager', 'fail_fast': 'False', 'quiet': 'False', 'profiles_dir': '/home/dbt/.dbt', 'printer_width': '80'}
[0m13:55:55.044383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c1292f90>]}
[0m13:55:55.151502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c2283410>]}
[0m13:55:55.152523 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:55:55.252089 [debug] [MainThread]: checksum: 2980a21a4fc584f27f03453e4d43c980470d5de79693c5ce0bc2b462a52f088e, vars: {}, profile: , target: prod, version: 1.10.9
[0m13:55:55.252968 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m13:55:55.253447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c11eddf0>]}
[0m13:55:57.218411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c04b8500>]}
[0m13:55:57.315404 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m13:55:57.317784 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m13:55:57.347526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936bfb9ed20>]}
[0m13:55:57.348156 [info ] [MainThread]: Found 12 models, 1 seed, 11 sources, 575 macros
[0m13:55:57.351359 [info ] [MainThread]: 
[0m13:55:57.351916 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m13:55:57.352296 [info ] [MainThread]: 
[0m13:55:57.352929 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:55:57.358512 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m13:55:57.359284 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m13:55:57.360004 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m13:55:57.360700 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m13:55:57.520929 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m13:55:57.521489 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m13:55:57.521995 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m13:55:57.522399 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m13:55:57.522854 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m13:55:57.523328 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m13:55:57.523796 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m13:55:57.524219 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:55:57.524667 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m13:55:57.525108 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:55:57.525543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:55:57.526193 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:55:57.550697 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.026 seconds
[0m13:55:57.552640 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m13:55:57.553384 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.028 seconds
[0m13:55:57.555466 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m13:55:57.556014 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.030 seconds
[0m13:55:57.556498 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.031 seconds
[0m13:55:57.558215 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m13:55:57.560149 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m13:55:57.563249 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_stg)
[0m13:55:57.564008 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_mart)
[0m13:55:57.564760 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics)
[0m13:55:57.572697 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m13:55:57.579458 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: BEGIN
[0m13:55:57.576464 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m13:55:57.578951 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m13:55:57.573930 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_int)
[0m13:55:57.579824 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:55:57.580238 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: BEGIN
[0m13:55:57.580681 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: BEGIN
[0m13:55:57.583117 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m13:55:57.583831 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:55:57.584278 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:55:57.585099 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: BEGIN
[0m13:55:57.586015 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:55:57.605731 [debug] [ThreadPool]: SQL status: BEGIN in 0.022 seconds
[0m13:55:57.606278 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m13:55:57.606783 [debug] [ThreadPool]: SQL status: BEGIN in 0.022 seconds
[0m13:55:57.607370 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_mart"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_mart'
  
[0m13:55:57.607956 [debug] [ThreadPool]: SQL status: BEGIN in 0.028 seconds
[0m13:55:57.608399 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m13:55:57.608885 [debug] [ThreadPool]: SQL status: BEGIN in 0.023 seconds
[0m13:55:57.609351 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m13:55:57.609823 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics'
  
[0m13:55:57.610284 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m13:55:57.610753 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_stg"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_stg'
  
[0m13:55:57.611340 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_int"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_int'
  
[0m13:55:57.612688 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m13:55:57.614324 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: ROLLBACK
[0m13:55:57.615592 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:55:57.616020 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: Close
[0m13:55:57.617517 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: ROLLBACK
[0m13:55:57.617990 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m13:55:57.618358 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.007 seconds
[0m13:55:57.620214 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: ROLLBACK
[0m13:55:57.620997 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: Close
[0m13:55:57.622463 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: ROLLBACK
[0m13:55:57.623464 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: Close
[0m13:55:57.623830 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: Close
[0m13:55:57.633614 [debug] [MainThread]: Using postgres connection "master"
[0m13:55:57.634108 [debug] [MainThread]: On master: BEGIN
[0m13:55:57.634448 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:55:57.649649 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m13:55:57.650170 [debug] [MainThread]: Using postgres connection "master"
[0m13:55:57.650672 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:55:57.668927 [debug] [MainThread]: SQL status: SELECT 0 in 0.018 seconds
[0m13:55:57.670642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c035f080>]}
[0m13:55:57.671278 [debug] [MainThread]: On master: ROLLBACK
[0m13:55:57.672104 [debug] [MainThread]: Using postgres connection "master"
[0m13:55:57.672522 [debug] [MainThread]: On master: BEGIN
[0m13:55:57.673647 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:55:57.674047 [debug] [MainThread]: On master: COMMIT
[0m13:55:57.674387 [debug] [MainThread]: Using postgres connection "master"
[0m13:55:57.674776 [debug] [MainThread]: On master: COMMIT
[0m13:55:57.675529 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:55:57.675916 [debug] [MainThread]: On master: Close
[0m13:55:57.679308 [debug] [Thread-1 (]: Began running node model.opensrp_mh.stg_encounter
[0m13:55:57.680236 [debug] [Thread-2 (]: Began running node model.opensrp_mh.stg_patient
[0m13:55:57.680831 [debug] [Thread-3 (]: Began running node model.opensrp_mh.stg_practitioner
[0m13:55:57.681932 [debug] [Thread-4 (]: Began running node model.opensrp_mh.stg_questionnaire_response
[0m13:55:57.681503 [info ] [Thread-1 (]: 1 of 13 START sql view model engage_analytics_stg.stg_encounter ................ [RUN]
[0m13:55:57.682741 [info ] [Thread-2 (]: 2 of 13 START sql view model engage_analytics_stg.stg_patient .................. [RUN]
[0m13:55:57.684642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_stg, now model.opensrp_mh.stg_encounter)
[0m13:55:57.685225 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics, now model.opensrp_mh.stg_patient)
[0m13:55:57.683328 [info ] [Thread-3 (]: 3 of 13 START sql view model engage_analytics_stg.stg_practitioner ............. [RUN]
[0m13:55:57.687148 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_int, now model.opensrp_mh.stg_practitioner)
[0m13:55:57.686616 [debug] [Thread-2 (]: Began compiling node model.opensrp_mh.stg_patient
[0m13:55:57.684074 [info ] [Thread-4 (]: 4 of 13 START sql view model engage_analytics_stg.stg_questionnaire_response ... [RUN]
[0m13:55:57.685948 [debug] [Thread-1 (]: Began compiling node model.opensrp_mh.stg_encounter
[0m13:55:57.687641 [debug] [Thread-3 (]: Began compiling node model.opensrp_mh.stg_practitioner
[0m13:55:57.696628 [debug] [Thread-2 (]: Writing injected SQL for node "model.opensrp_mh.stg_patient"
[0m13:55:57.697285 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_mart, now model.opensrp_mh.stg_questionnaire_response)
[0m13:55:57.702158 [debug] [Thread-1 (]: Writing injected SQL for node "model.opensrp_mh.stg_encounter"
[0m13:55:57.706189 [debug] [Thread-3 (]: Writing injected SQL for node "model.opensrp_mh.stg_practitioner"
[0m13:55:57.707067 [debug] [Thread-4 (]: Began compiling node model.opensrp_mh.stg_questionnaire_response
[0m13:55:57.712506 [debug] [Thread-4 (]: Writing injected SQL for node "model.opensrp_mh.stg_questionnaire_response"
[0m13:55:57.713283 [debug] [Thread-3 (]: Began executing node model.opensrp_mh.stg_practitioner
[0m13:55:57.727225 [debug] [Thread-1 (]: Began executing node model.opensrp_mh.stg_encounter
[0m13:55:57.727793 [debug] [Thread-4 (]: Began executing node model.opensrp_mh.stg_questionnaire_response
[0m13:55:57.728255 [debug] [Thread-2 (]: Began executing node model.opensrp_mh.stg_patient
[0m13:55:57.783592 [debug] [Thread-1 (]: Writing runtime sql for node "model.opensrp_mh.stg_encounter"
[0m13:55:57.784959 [debug] [Thread-4 (]: Writing runtime sql for node "model.opensrp_mh.stg_questionnaire_response"
[0m13:55:57.786772 [debug] [Thread-3 (]: Writing runtime sql for node "model.opensrp_mh.stg_practitioner"
[0m13:55:57.790752 [debug] [Thread-2 (]: Writing runtime sql for node "model.opensrp_mh.stg_patient"
[0m13:55:57.792604 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m13:55:57.793217 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m13:55:57.793838 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m13:55:57.794331 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m13:55:57.794815 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: BEGIN
[0m13:55:57.795306 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: BEGIN
[0m13:55:57.795809 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: BEGIN
[0m13:55:57.796279 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: BEGIN
[0m13:55:57.796767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:55:57.797230 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:55:57.797716 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:55:57.798175 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:55:57.820611 [debug] [Thread-2 (]: SQL status: BEGIN in 0.023 seconds
[0m13:55:57.821195 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m13:55:57.821679 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_tmp"
    
    
  as (
    with src as (
    select
        id as fhir_id,
        resource,
        resource ->> 'id'                  as resource_id,
        resource -> 'meta' ->> 'versionId' as version_id,
        resource -> 'meta' ->> 'lastUpdated' as meta_last_updated,
        resource ->> 'gender'              as gender,
        resource ->> 'birthDate'           as birth_date,
        resource ->> 'active'              as active,
        
    -- Handle ISO strings from FHIR meta/fields safely
    (lastUpdated::timestamptz)
 as lastUpdated_ts,
        _airbyte_extracted_at
    from "data_warehouse"."airbyte"."patient"
)
select * from src
  );
[0m13:55:57.822198 [debug] [Thread-4 (]: SQL status: BEGIN in 0.024 seconds
[0m13:55:57.822903 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m13:55:57.824016 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_tmp"
    
    
  as (
    with base as (
    select
        id as fhir_id,
        resource,
        resource ->> 'id'                          as resource_id,
        resource ->> 'status'                      as status,
        resource ->> 'questionnaire'               as questionnaire_canonical,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'subject' ->> 'reference', '^\w+/', ''))
    as patient_id,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'encounter' ->> 'reference', '^\w+/', ''))
  as encounter_id,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'author' ->> 'reference', '^\w+/', ''))
     as author_id,
        
    -- Handle ISO strings from FHIR meta/fields safely
    (resource ->> 'authored'::timestamptz)
 as authored_ts,
        
    -- Handle ISO strings from FHIR meta/fields safely
    (lastUpdated::timestamptz)
        as lastUpdated_ts,
        _airbyte_extracted_at
    from "data_warehouse"."airbyte"."questionnaire_response"
)
select * from base
  );
[0m13:55:57.823503 [debug] [Thread-3 (]: SQL status: BEGIN in 0.026 seconds
[0m13:55:57.824568 [debug] [Thread-2 (]: Postgres adapter: Postgres error: column "lastupdated" does not exist
LINE 19:     (lastUpdated::timestamptz)
              ^
HINT:  Perhaps you meant to reference the column "patient.lastUpdated".

[0m13:55:57.825281 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m13:55:57.825848 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: ROLLBACK
[0m13:55:57.826408 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_tmp"
    
    
  as (
    select
    id as fhir_id,
    resource,
    resource ->> 'id'                            as resource_id,
    resource -> 'name' -> 0 ->> 'family'         as family_name,
    resource -> 'name' -> 0 -> 'given' ->> 0     as given_name,
    resource -> 'telecom' -> 0 ->> 'value'       as phone_raw,
    
    -- Handle ISO strings from FHIR meta/fields safely
    (lastUpdated::timestamptz)
          as lastUpdated_ts,
    _airbyte_extracted_at
from "data_warehouse"."airbyte"."practitioner"
  );
[0m13:55:57.826948 [debug] [Thread-1 (]: SQL status: BEGIN in 0.030 seconds
[0m13:55:57.827408 [debug] [Thread-4 (]: Postgres adapter: Postgres error: invalid input syntax for type timestamp with time zone: "authored"
LINE 28:     (resource ->> 'authored'::timestamptz)
                           ^

[0m13:55:57.828139 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m13:55:57.828772 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: Close
[0m13:55:57.829272 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "lastupdated" does not exist
LINE 16:     (lastUpdated::timestamptz)
              ^
HINT:  Perhaps you meant to reference the column "practitioner.lastUpdated".

[0m13:55:57.829729 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: ROLLBACK
[0m13:55:57.830284 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_encounter"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_encounter__dbt_tmp"
    
    
  as (
    select
    id as fhir_id,
    resource,
    resource ->> 'id'                                 as resource_id,
    resource ->> 'status'                             as status,
    resource -> 'class' ->> 'code'                    as class_code,
    resource -> 'type'  -> 0 -> 'coding' -> 0 ->> 'code' as type_code,
    resource -> 'type'  -> 0 -> 'coding' -> 0 ->> 'display' as type_display,
    
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'subject' ->> 'reference', '^\w+/', ''))
 as patient_id,
    
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'participant' -> 0 -> 'individual' ->> 'reference', '^\w+/', ''))
 as practitioner_id,
    
    -- Handle ISO strings from FHIR meta/fields safely
    (resource ->> 'period' ->> 'start'::timestamptz)
 as period_start,
    
    -- Handle ISO strings from FHIR meta/fields safely
    (resource ->> 'period' ->> 'end'::timestamptz)
   as period_end,
    
    -- Handle ISO strings from FHIR meta/fields safely
    (lastUpdated::timestamptz)
                       as lastUpdated_ts,
    _airbyte_extracted_at
from "data_warehouse"."airbyte"."encounter"
  );
[0m13:55:57.830957 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: ROLLBACK
[0m13:55:57.833333 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: Close
[0m13:55:57.834348 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: Close
[0m13:55:57.835074 [debug] [Thread-1 (]: Postgres adapter: Postgres error: invalid input syntax for type timestamp with time zone: "start"
LINE 25:     (resource ->> 'period' ->> 'start'::timestamptz)
                                        ^

[0m13:55:57.839679 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: ROLLBACK
[0m13:55:57.842052 [debug] [Thread-2 (]: Database Error in model stg_patient (models/staging/stg_patient.sql)
  column "lastupdated" does not exist
  LINE 19:     (lastUpdated::timestamptz)
                ^
  HINT:  Perhaps you meant to reference the column "patient.lastUpdated".
  compiled code at target/run/opensrp_mh/models/staging/stg_patient.sql
[0m13:55:57.843859 [debug] [Thread-3 (]: Database Error in model stg_practitioner (models/staging/stg_practitioner.sql)
  column "lastupdated" does not exist
  LINE 16:     (lastUpdated::timestamptz)
                ^
  HINT:  Perhaps you meant to reference the column "practitioner.lastUpdated".
  compiled code at target/run/opensrp_mh/models/staging/stg_practitioner.sql
[0m13:55:57.845701 [debug] [Thread-4 (]: Database Error in model stg_questionnaire_response (models/staging/stg_questionnaire_response.sql)
  invalid input syntax for type timestamp with time zone: "authored"
  LINE 28:     (resource ->> 'authored'::timestamptz)
                             ^
  compiled code at target/run/opensrp_mh/models/staging/stg_questionnaire_response.sql
[0m13:55:57.846332 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: Close
[0m13:55:57.848827 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936bfce3ce0>]}
[0m13:55:57.849364 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c224c650>]}
[0m13:55:57.849886 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c02e0530>]}
[0m13:55:57.850932 [error] [Thread-2 (]: 2 of 13 ERROR creating sql view model engage_analytics_stg.stg_patient ......... [[31mERROR[0m in 0.16s]
[0m13:55:57.851839 [error] [Thread-3 (]: 3 of 13 ERROR creating sql view model engage_analytics_stg.stg_practitioner .... [[31mERROR[0m in 0.16s]
[0m13:55:57.855878 [debug] [Thread-1 (]: Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  invalid input syntax for type timestamp with time zone: "start"
  LINE 25:     (resource ->> 'period' ->> 'start'::timestamptz)
                                          ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql
[0m13:55:57.854148 [error] [Thread-4 (]: 4 of 13 ERROR creating sql view model engage_analytics_stg.stg_questionnaire_response  [[31mERROR[0m in 0.15s]
[0m13:55:57.856838 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.stg_patient
[0m13:55:57.857593 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.stg_practitioner
[0m13:55:57.858182 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c02753d0>]}
[0m13:55:57.858902 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.stg_questionnaire_response
[0m13:55:57.859489 [debug] [Thread-2 (]: Began running node seed.opensrp_mh.score_map
[0m13:55:57.860138 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_patient' to be skipped because of status 'error'.  Reason: Database Error in model stg_patient (models/staging/stg_patient.sql)
  column "lastupdated" does not exist
  LINE 19:     (lastUpdated::timestamptz)
                ^
  HINT:  Perhaps you meant to reference the column "patient.lastUpdated".
  compiled code at target/run/opensrp_mh/models/staging/stg_patient.sql.
[0m13:55:57.861112 [error] [Thread-1 (]: 1 of 13 ERROR creating sql view model engage_analytics_stg.stg_encounter ....... [[31mERROR[0m in 0.17s]
[0m13:55:57.861941 [info ] [Thread-2 (]: 5 of 13 START seed file engage_analytics.score_map ............................. [RUN]
[0m13:55:57.863102 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_practitioner' to be skipped because of status 'error'.  Reason: Database Error in model stg_practitioner (models/staging/stg_practitioner.sql)
  column "lastupdated" does not exist
  LINE 16:     (lastUpdated::timestamptz)
                ^
  HINT:  Perhaps you meant to reference the column "practitioner.lastUpdated".
  compiled code at target/run/opensrp_mh/models/staging/stg_practitioner.sql.
[0m13:55:57.863924 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.stg_encounter
[0m13:55:57.864986 [debug] [Thread-3 (]: Began running node model.opensrp_mh.dim_patient
[0m13:55:57.864530 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_patient, now seed.opensrp_mh.score_map)
[0m13:55:57.865669 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_questionnaire_response' to be skipped because of status 'error'.  Reason: Database Error in model stg_questionnaire_response (models/staging/stg_questionnaire_response.sql)
  invalid input syntax for type timestamp with time zone: "authored"
  LINE 28:     (resource ->> 'authored'::timestamptz)
                             ^
  compiled code at target/run/opensrp_mh/models/staging/stg_questionnaire_response.sql.
[0m13:55:57.866385 [info ] [Thread-3 (]: 6 of 13 SKIP relation engage_analytics_mart.dim_patient ........................ [[33mSKIP[0m]
[0m13:55:57.868823 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.dim_patient
[0m13:55:57.867484 [debug] [Thread-2 (]: Began compiling node seed.opensrp_mh.score_map
[0m13:55:57.868189 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_encounter' to be skipped because of status 'error'.  Reason: Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  invalid input syntax for type timestamp with time zone: "start"
  LINE 25:     (resource ->> 'period' ->> 'start'::timestamptz)
                                          ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql.
[0m13:55:57.867005 [debug] [Thread-4 (]: Began running node model.opensrp_mh.dim_practitioner
[0m13:55:57.869315 [debug] [Thread-3 (]: Began running node model.opensrp_mh.int_qr_answers_long
[0m13:55:57.869832 [debug] [Thread-2 (]: Began executing node seed.opensrp_mh.score_map
[0m13:55:57.870328 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.dim_patient' to be skipped because of status 'skipped'. 
[0m13:55:57.871486 [debug] [Thread-1 (]: Began running node model.opensrp_mh.fact_encounter
[0m13:55:57.870994 [info ] [Thread-4 (]: 7 of 13 SKIP relation engage_analytics_mart.dim_practitioner ................... [[33mSKIP[0m]
[0m13:55:57.872022 [info ] [Thread-3 (]: 8 of 13 SKIP relation engage_analytics_int.int_qr_answers_long ................. [[33mSKIP[0m]
[0m13:55:57.905805 [debug] [Thread-2 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m13:55:57.905032 [info ] [Thread-1 (]: 9 of 13 SKIP relation engage_analytics_mart.fact_encounter ..................... [[33mSKIP[0m]
[0m13:55:57.906624 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.dim_practitioner
[0m13:55:57.907183 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.int_qr_answers_long
[0m13:55:57.907707 [debug] [Thread-2 (]: On seed.opensrp_mh.score_map: BEGIN
[0m13:55:57.908217 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.fact_encounter
[0m13:55:57.908747 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.dim_practitioner' to be skipped because of status 'skipped'. 
[0m13:55:57.909317 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:55:57.909975 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.int_qr_answers_long' to be skipped because of status 'skipped'. 
[0m13:55:57.911249 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.fact_encounter' to be skipped because of status 'skipped'. 
[0m13:55:57.912233 [debug] [Thread-4 (]: Began running node model.opensrp_mh.fact_qr_latest_scores
[0m13:55:57.912757 [debug] [Thread-3 (]: Began running node model.opensrp_mh.core_counts
[0m13:55:57.913311 [info ] [Thread-4 (]: 10 of 13 SKIP relation engage_analytics_mart.fact_qr_latest_scores ............. [[33mSKIP[0m]
[0m13:55:57.914962 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.fact_qr_latest_scores
[0m13:55:57.914354 [info ] [Thread-3 (]: 11 of 13 SKIP relation engage_analytics_mart.core_counts ....................... [[33mSKIP[0m]
[0m13:55:57.913862 [debug] [Thread-1 (]: Began running node model.opensrp_mh.patients_no_followup
[0m13:55:57.915481 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.fact_qr_latest_scores' to be skipped because of status 'skipped'. 
[0m13:55:57.916018 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.core_counts
[0m13:55:57.916581 [info ] [Thread-1 (]: 12 of 13 SKIP relation engage_analytics_mart.patients_no_followup .............. [[33mSKIP[0m]
[0m13:55:57.917356 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.core_counts' to be skipped because of status 'skipped'. 
[0m13:55:57.917876 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.patients_no_followup
[0m13:55:57.918493 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.patients_no_followup' to be skipped because of status 'skipped'. 
[0m13:55:57.925386 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m13:55:57.925956 [debug] [Thread-2 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m13:55:57.926357 [debug] [Thread-2 (]: On seed.opensrp_mh.score_map: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "seed.opensrp_mh.score_map"} */
truncate table "data_warehouse"."engage_analytics"."score_map"
[0m13:55:57.930302 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.003 seconds
[0m13:55:57.950380 [debug] [Thread-2 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m13:55:57.950979 [debug] [Thread-2 (]: On seed.opensrp_mh.score_map: 
          insert into "data_warehouse"."engage_analytics"."score_map" ("questionnaire_match", "link_id", "coding_code", "numeric_value") values
          (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m13:55:57.952379 [debug] [Thread-2 (]: SQL status: INSERT 0 4 in 0.001 seconds
[0m13:55:57.958998 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.opensrp_mh.score_map"
[0m13:55:57.976623 [debug] [Thread-2 (]: On seed.opensrp_mh.score_map: COMMIT
[0m13:55:57.977180 [debug] [Thread-2 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m13:55:57.977603 [debug] [Thread-2 (]: On seed.opensrp_mh.score_map: COMMIT
[0m13:55:57.979650 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m13:55:57.981812 [debug] [Thread-2 (]: On seed.opensrp_mh.score_map: Close
[0m13:55:57.982767 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a483f185-88c2-4ac1-970a-6a736435334b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c3c965d0>]}
[0m13:55:57.983409 [info ] [Thread-2 (]: 5 of 13 OK loaded seed file engage_analytics.score_map ......................... [[32mINSERT 4[0m in 0.12s]
[0m13:55:57.984123 [debug] [Thread-2 (]: Finished running node seed.opensrp_mh.score_map
[0m13:55:57.984919 [debug] [Thread-4 (]: Began running node model.opensrp_mh.int_qr_answers_scored
[0m13:55:57.985617 [info ] [Thread-4 (]: 13 of 13 SKIP relation engage_analytics_int.int_qr_answers_scored .............. [[33mSKIP[0m]
[0m13:55:57.986138 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.int_qr_answers_scored
[0m13:55:57.986557 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.int_qr_answers_scored' to be skipped because of status 'skipped'. 
[0m13:55:57.988156 [debug] [MainThread]: Using postgres connection "master"
[0m13:55:57.988597 [debug] [MainThread]: On master: BEGIN
[0m13:55:57.988926 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:55:58.008533 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m13:55:58.009128 [debug] [MainThread]: On master: COMMIT
[0m13:55:58.009562 [debug] [MainThread]: Using postgres connection "master"
[0m13:55:58.009957 [debug] [MainThread]: On master: COMMIT
[0m13:55:58.010700 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:55:58.011165 [debug] [MainThread]: On master: Close
[0m13:55:58.012092 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:55:58.012519 [debug] [MainThread]: Connection 'model.opensrp_mh.stg_practitioner' was properly closed.
[0m13:55:58.012836 [debug] [MainThread]: Connection 'seed.opensrp_mh.score_map' was properly closed.
[0m13:55:58.013126 [debug] [MainThread]: Connection 'model.opensrp_mh.stg_encounter' was properly closed.
[0m13:55:58.013439 [debug] [MainThread]: Connection 'model.opensrp_mh.stg_questionnaire_response' was properly closed.
[0m13:55:58.013932 [info ] [MainThread]: 
[0m13:55:58.014375 [info ] [MainThread]: Finished running 1 seed, 12 view models in 0 hours 0 minutes and 0.66 seconds (0.66s).
[0m13:55:58.016187 [debug] [MainThread]: Command end result
[0m13:55:58.052968 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m13:55:58.055836 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m13:55:58.063327 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/run_results.json
[0m13:55:58.063852 [info ] [MainThread]: 
[0m13:55:58.064334 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m13:55:58.064782 [info ] [MainThread]: 
[0m13:55:58.065260 [error] [MainThread]: [31mFailure in model stg_patient (models/staging/stg_patient.sql)[0m
[0m13:55:58.065744 [error] [MainThread]:   Database Error in model stg_patient (models/staging/stg_patient.sql)
  column "lastupdated" does not exist
  LINE 19:     (lastUpdated::timestamptz)
                ^
  HINT:  Perhaps you meant to reference the column "patient.lastUpdated".
  compiled code at target/run/opensrp_mh/models/staging/stg_patient.sql
[0m13:55:58.066108 [info ] [MainThread]: 
[0m13:55:58.066553 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_patient.sql
[0m13:55:58.067001 [info ] [MainThread]: 
[0m13:55:58.067471 [error] [MainThread]: [31mFailure in model stg_practitioner (models/staging/stg_practitioner.sql)[0m
[0m13:55:58.067911 [error] [MainThread]:   Database Error in model stg_practitioner (models/staging/stg_practitioner.sql)
  column "lastupdated" does not exist
  LINE 16:     (lastUpdated::timestamptz)
                ^
  HINT:  Perhaps you meant to reference the column "practitioner.lastUpdated".
  compiled code at target/run/opensrp_mh/models/staging/stg_practitioner.sql
[0m13:55:58.068256 [info ] [MainThread]: 
[0m13:55:58.068674 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_practitioner.sql
[0m13:55:58.069020 [info ] [MainThread]: 
[0m13:55:58.069451 [error] [MainThread]: [31mFailure in model stg_questionnaire_response (models/staging/stg_questionnaire_response.sql)[0m
[0m13:55:58.069879 [error] [MainThread]:   Database Error in model stg_questionnaire_response (models/staging/stg_questionnaire_response.sql)
  invalid input syntax for type timestamp with time zone: "authored"
  LINE 28:     (resource ->> 'authored'::timestamptz)
                             ^
  compiled code at target/run/opensrp_mh/models/staging/stg_questionnaire_response.sql
[0m13:55:58.070217 [info ] [MainThread]: 
[0m13:55:58.070639 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_questionnaire_response.sql
[0m13:55:58.070992 [info ] [MainThread]: 
[0m13:55:58.071384 [error] [MainThread]: [31mFailure in model stg_encounter (models/staging/stg_encounter.sql)[0m
[0m13:55:58.071901 [error] [MainThread]:   Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  invalid input syntax for type timestamp with time zone: "start"
  LINE 25:     (resource ->> 'period' ->> 'start'::timestamptz)
                                          ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql
[0m13:55:58.072276 [info ] [MainThread]: 
[0m13:55:58.072679 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_encounter.sql
[0m13:55:58.073001 [info ] [MainThread]: 
[0m13:55:58.073369 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=4 SKIP=8 NO-OP=0 TOTAL=13
[0m13:55:58.074662 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 3.3741932, "process_in_blocks": "0", "process_kernel_time": 0.265651, "process_mem_max_rss": "132012", "process_out_blocks": "4032", "process_user_time": 4.940746}
[0m13:55:58.075383 [debug] [MainThread]: Command `dbt build` failed at 13:55:58.075263 after 3.38 seconds
[0m13:55:58.075866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c224f380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c1aeb110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe936c1ae8440>]}
[0m13:55:58.076296 [debug] [MainThread]: Flushing usage events
[0m13:55:58.130936 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:29:29.118993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe7604ff76660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe7604ffcecc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe76051dd5400>]}


============================== 14:29:29.123143 | 7b9c45b1-c8b1-40b2-8b0f-18fc5f13e242 ==============================
[0m14:29:29.123143 [info ] [MainThread]: Running with dbt=1.10.9
[0m14:29:29.123871 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'static_parser': 'True', 'write_json': 'True', 'profiles_dir': '/home/dbt/.dbt', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'introspect': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'empty': 'None', 'version_check': 'True', 'invocation_command': 'dbt debug', 'printer_width': '80', 'debug': 'False'}
[0m14:29:29.133918 [info ] [MainThread]: dbt version: 1.10.9
[0m14:29:29.134454 [info ] [MainThread]: python version: 3.12.3
[0m14:29:29.134858 [info ] [MainThread]: python path: /home/dbt/.venvs/dbt/bin/python3
[0m14:29:29.135224 [info ] [MainThread]: os info: Linux-6.14.0-1011-aws-aarch64-with-glibc2.39
[0m14:29:29.210836 [info ] [MainThread]: Using profiles dir at /home/dbt/.dbt
[0m14:29:29.211405 [info ] [MainThread]: Using profiles.yml file at /home/dbt/.dbt/profiles.yml
[0m14:29:29.211804 [info ] [MainThread]: Using dbt_project.yml file at /home/dbt/fhir-analytics-repo/engage-analytics/dbt/dbt_project.yml
[0m14:29:29.212378 [info ] [MainThread]: adapter type: postgres
[0m14:29:29.212786 [info ] [MainThread]: adapter version: 1.9.0
[0m14:29:29.379112 [info ] [MainThread]: Configuration:
[0m14:29:29.379721 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m14:29:29.380112 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m14:29:29.380508 [info ] [MainThread]: Required dependencies:
[0m14:29:29.380921 [debug] [MainThread]: Executing "git --help"
[0m14:29:29.383200 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m14:29:29.383725 [debug] [MainThread]: STDERR: "b''"
[0m14:29:29.384050 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m14:29:29.384430 [info ] [MainThread]: Connection:
[0m14:29:29.384817 [info ] [MainThread]:   host: omh-engage-production-postgres.cwb4kemo2n2s.us-east-1.rds.amazonaws.com
[0m14:29:29.385165 [info ] [MainThread]:   port: 5432
[0m14:29:29.385535 [info ] [MainThread]:   user: data_warehouse_user
[0m14:29:29.385889 [info ] [MainThread]:   database: data_warehouse
[0m14:29:29.386242 [info ] [MainThread]:   schema: engage_analytics
[0m14:29:29.386619 [info ] [MainThread]:   connect_timeout: 30
[0m14:29:29.386968 [info ] [MainThread]:   role: None
[0m14:29:29.387318 [info ] [MainThread]:   search_path: None
[0m14:29:29.387701 [info ] [MainThread]:   keepalives_idle: 0
[0m14:29:29.388052 [info ] [MainThread]:   sslmode: prefer
[0m14:29:29.388393 [info ] [MainThread]:   sslcert: None
[0m14:29:29.388774 [info ] [MainThread]:   sslkey: None
[0m14:29:29.389111 [info ] [MainThread]:   sslrootcert: None
[0m14:29:29.389467 [info ] [MainThread]:   application_name: dbt
[0m14:29:29.389802 [info ] [MainThread]:   retries: 1
[0m14:29:29.390324 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:29:29.467680 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m14:29:29.493636 [debug] [MainThread]: Using postgres connection "debug"
[0m14:29:29.494137 [debug] [MainThread]: On debug: select 1 as id
[0m14:29:29.494484 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:29:29.513607 [debug] [MainThread]: SQL status: SELECT 1 in 0.019 seconds
[0m14:29:29.515002 [debug] [MainThread]: On debug: Close
[0m14:29:29.515618 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m14:29:29.516138 [info ] [MainThread]: [32mAll checks passed![0m
[0m14:29:29.517272 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.4848654, "process_in_blocks": "0", "process_kernel_time": 0.229027, "process_mem_max_rss": "113252", "process_out_blocks": "16", "process_user_time": 2.110044}
[0m14:29:29.517862 [debug] [MainThread]: Command `dbt debug` succeeded at 14:29:29.517742 after 0.49 seconds
[0m14:29:29.518222 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m14:29:29.518633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe7604ff76660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe7604e3de0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe7604f8ee9f0>]}
[0m14:29:29.519098 [debug] [MainThread]: Flushing usage events
[0m14:29:29.568374 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:29:55.295207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea01569f530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea015c0ee70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea015c0f5f0>]}


============================== 14:29:55.299384 | 06e9cc07-c43a-43af-8b53-d648c10e472a ==============================
[0m14:29:55.299384 [info ] [MainThread]: Running with dbt=1.10.9
[0m14:29:55.300097 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'profiles_dir': '/home/dbt/.dbt', 'empty': 'None', 'log_cache_events': 'False', 'target_path': 'None', 'no_print': 'None', 'warn_error': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'introspect': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'static_parser': 'True', 'quiet': 'False', 'invocation_command': 'dbt deps', 'debug': 'False', 'partial_parse': 'True', 'version_check': 'True', 'use_experimental_parser': 'False', 'log_format': 'default'}
[0m14:29:55.479586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06e9cc07-c43a-43af-8b53-d648c10e472a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea01607e1e0>]}
[0m14:29:55.507126 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-mwi5lzlk'
[0m14:29:55.507730 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m14:29:55.563287 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m14:29:55.565817 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m14:29:55.614178 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m14:29:55.620496 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json
[0m14:29:55.667886 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json 200
[0m14:29:55.672240 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m14:29:55.762788 [info ] [MainThread]: Installed from version 1.3.0
[0m14:29:55.763343 [info ] [MainThread]: Up to date!
[0m14:29:55.763861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '06e9cc07-c43a-43af-8b53-d648c10e472a', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea0160b8260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea0150d8260>]}
[0m14:29:55.764314 [info ] [MainThread]: Installing dbt-labs/codegen
[0m14:29:55.829603 [info ] [MainThread]: Installed from version 0.13.1
[0m14:29:55.830203 [info ] [MainThread]: Up to date!
[0m14:29:55.830683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '06e9cc07-c43a-43af-8b53-d648c10e472a', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea014e13230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea014e13260>]}
[0m14:29:55.832099 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.6244684, "process_in_blocks": "0", "process_kernel_time": 0.221059, "process_mem_max_rss": "103316", "process_out_blocks": "3072", "process_user_time": 2.255381}
[0m14:29:55.832692 [debug] [MainThread]: Command `dbt deps` succeeded at 14:29:55.832571 after 0.63 seconds
[0m14:29:55.833086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea0151af740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea015927500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfea0197b3410>]}
[0m14:29:55.833532 [debug] [MainThread]: Flushing usage events
[0m14:29:55.882661 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:30:04.380469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d4d50980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d4a5e570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d4a5cda0>]}


============================== 14:30:04.384608 | 0263acde-32d8-44c3-9eca-fbb22908705e ==============================
[0m14:30:04.384608 [info ] [MainThread]: Running with dbt=1.10.9
[0m14:30:04.385280 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'quiet': 'False', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'printer_width': '80', 'invocation_command': 'dbt build', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'indirect_selection': 'eager', 'empty': 'False', 'static_parser': 'True', 'use_colors': 'True', 'target_path': 'None', 'profiles_dir': '/home/dbt/.dbt', 'no_print': 'None'}
[0m14:30:04.626960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d447af90>]}
[0m14:30:04.732006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d442ef60>]}
[0m14:30:04.733029 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:30:04.837389 [debug] [MainThread]: checksum: 2980a21a4fc584f27f03453e4d43c980470d5de79693c5ce0bc2b462a52f088e, vars: {}, profile: , target: prod, version: 1.10.9
[0m14:30:04.988221 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 5 files changed.
[0m14:30:04.989070 [debug] [MainThread]: Partial parsing: updated file: opensrp_mh://models/staging/stg_patient.sql
[0m14:30:04.989586 [debug] [MainThread]: Partial parsing: updated file: opensrp_mh://models/staging/stg_practitioner.sql
[0m14:30:04.990033 [debug] [MainThread]: Partial parsing: updated file: opensrp_mh://models/staging/stg_encounter.sql
[0m14:30:04.990755 [debug] [MainThread]: Partial parsing: updated file: opensrp_mh://macros/utils.sql
[0m14:30:04.991160 [debug] [MainThread]: Partial parsing: updated file: opensrp_mh://models/staging/stg_questionnaire_response.sql
[0m14:30:05.444044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d33f1d30>]}
[0m14:30:05.546562 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m14:30:05.549329 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m14:30:05.676253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d2e2c770>]}
[0m14:30:05.676952 [info ] [MainThread]: Found 12 models, 1 seed, 11 sources, 575 macros
[0m14:30:05.680187 [info ] [MainThread]: 
[0m14:30:05.680805 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m14:30:05.681161 [info ] [MainThread]: 
[0m14:30:05.681767 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:30:05.687559 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:30:05.688380 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:30:05.689137 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:30:05.700463 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:30:05.747762 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:30:05.748324 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:30:05.748860 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:30:05.749278 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:30:05.749757 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:30:05.750281 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:30:05.750794 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:30:05.751253 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:30:05.751710 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:30:05.753192 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:30:05.752129 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:30:05.752556 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:30:05.776694 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.023 seconds
[0m14:30:05.778763 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:30:05.779495 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.028 seconds
[0m14:30:05.780060 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.028 seconds
[0m14:30:05.780945 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.028 seconds
[0m14:30:05.782614 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:30:05.784309 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:30:05.786042 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:30:05.789734 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics)
[0m14:30:05.790515 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_stg)
[0m14:30:05.791308 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_mart)
[0m14:30:05.797278 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_int)
[0m14:30:05.800355 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m14:30:05.803030 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m14:30:05.805465 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m14:30:05.807898 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m14:30:05.808434 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: BEGIN
[0m14:30:05.808892 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: BEGIN
[0m14:30:05.809308 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: BEGIN
[0m14:30:05.809748 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: BEGIN
[0m14:30:05.810153 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:30:05.810623 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:30:05.811051 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:30:05.811475 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:30:05.832898 [debug] [ThreadPool]: SQL status: BEGIN in 0.021 seconds
[0m14:30:05.833473 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m14:30:05.833884 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_int"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_int'
  
[0m14:30:05.834447 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m14:30:05.834878 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m14:30:05.835288 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_stg"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_stg'
  
[0m14:30:05.837616 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m14:30:05.838531 [debug] [ThreadPool]: SQL status: BEGIN in 0.027 seconds
[0m14:30:05.838106 [debug] [ThreadPool]: SQL status: BEGIN in 0.028 seconds
[0m14:30:05.842016 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: ROLLBACK
[0m14:30:05.842557 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.007 seconds
[0m14:30:05.843035 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m14:30:05.843501 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m14:30:05.845173 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: ROLLBACK
[0m14:30:05.845777 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: Close
[0m14:30:05.846284 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_mart"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_mart'
  
[0m14:30:05.846863 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics'
  
[0m14:30:05.847882 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: Close
[0m14:30:05.852513 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m14:30:05.853085 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m14:30:05.854737 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: ROLLBACK
[0m14:30:05.856302 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: ROLLBACK
[0m14:30:05.857317 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: Close
[0m14:30:05.857833 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: Close
[0m14:30:05.865295 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:05.865847 [debug] [MainThread]: On master: BEGIN
[0m14:30:05.866174 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:30:05.881454 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m14:30:05.881990 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:05.882455 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:30:05.900782 [debug] [MainThread]: SQL status: SELECT 0 in 0.018 seconds
[0m14:30:05.902519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d339aa50>]}
[0m14:30:05.903195 [debug] [MainThread]: On master: ROLLBACK
[0m14:30:05.904017 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:05.904399 [debug] [MainThread]: On master: BEGIN
[0m14:30:05.905460 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:30:05.905852 [debug] [MainThread]: On master: COMMIT
[0m14:30:05.906190 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:05.906531 [debug] [MainThread]: On master: COMMIT
[0m14:30:05.907170 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:30:05.907581 [debug] [MainThread]: On master: Close
[0m14:30:05.910862 [debug] [Thread-1 (]: Began running node model.opensrp_mh.stg_encounter
[0m14:30:05.911462 [debug] [Thread-2 (]: Began running node model.opensrp_mh.stg_patient
[0m14:30:05.911997 [debug] [Thread-3 (]: Began running node model.opensrp_mh.stg_practitioner
[0m14:30:05.913152 [debug] [Thread-4 (]: Began running node model.opensrp_mh.stg_questionnaire_response
[0m14:30:05.912674 [info ] [Thread-1 (]: 1 of 13 START sql view model engage_analytics_stg.stg_encounter ................ [RUN]
[0m14:30:05.913994 [info ] [Thread-2 (]: 2 of 13 START sql view model engage_analytics_stg.stg_patient .................. [RUN]
[0m14:30:05.914778 [info ] [Thread-3 (]: 3 of 13 START sql view model engage_analytics_stg.stg_practitioner ............. [RUN]
[0m14:30:05.916148 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_mart, now model.opensrp_mh.stg_encounter)
[0m14:30:05.915520 [info ] [Thread-4 (]: 4 of 13 START sql view model engage_analytics_stg.stg_questionnaire_response ... [RUN]
[0m14:30:05.917020 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics, now model.opensrp_mh.stg_patient)
[0m14:30:05.917594 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_stg, now model.opensrp_mh.stg_practitioner)
[0m14:30:05.918121 [debug] [Thread-1 (]: Began compiling node model.opensrp_mh.stg_encounter
[0m14:30:05.918669 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_int, now model.opensrp_mh.stg_questionnaire_response)
[0m14:30:05.919174 [debug] [Thread-2 (]: Began compiling node model.opensrp_mh.stg_patient
[0m14:30:05.919678 [debug] [Thread-3 (]: Began compiling node model.opensrp_mh.stg_practitioner
[0m14:30:05.930487 [debug] [Thread-1 (]: Writing injected SQL for node "model.opensrp_mh.stg_encounter"
[0m14:30:05.931169 [debug] [Thread-4 (]: Began compiling node model.opensrp_mh.stg_questionnaire_response
[0m14:30:05.935333 [debug] [Thread-2 (]: Writing injected SQL for node "model.opensrp_mh.stg_patient"
[0m14:30:05.939657 [debug] [Thread-3 (]: Writing injected SQL for node "model.opensrp_mh.stg_practitioner"
[0m14:30:05.944903 [debug] [Thread-4 (]: Writing injected SQL for node "model.opensrp_mh.stg_questionnaire_response"
[0m14:30:05.945675 [debug] [Thread-1 (]: Began executing node model.opensrp_mh.stg_encounter
[0m14:30:05.946579 [debug] [Thread-2 (]: Began executing node model.opensrp_mh.stg_patient
[0m14:30:05.947142 [debug] [Thread-3 (]: Began executing node model.opensrp_mh.stg_practitioner
[0m14:30:05.968878 [debug] [Thread-4 (]: Began executing node model.opensrp_mh.stg_questionnaire_response
[0m14:30:06.007572 [debug] [Thread-2 (]: Writing runtime sql for node "model.opensrp_mh.stg_patient"
[0m14:30:06.005267 [debug] [Thread-1 (]: Writing runtime sql for node "model.opensrp_mh.stg_encounter"
[0m14:30:06.015459 [debug] [Thread-3 (]: Writing runtime sql for node "model.opensrp_mh.stg_practitioner"
[0m14:30:06.019698 [debug] [Thread-4 (]: Writing runtime sql for node "model.opensrp_mh.stg_questionnaire_response"
[0m14:30:06.021297 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:30:06.022095 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m14:30:06.022912 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:30:06.023650 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: BEGIN
[0m14:30:06.024288 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:30:06.024890 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: BEGIN
[0m14:30:06.025483 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: BEGIN
[0m14:30:06.026027 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:30:06.026581 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: BEGIN
[0m14:30:06.027204 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:30:06.027865 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:30:06.028751 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:30:06.050092 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m14:30:06.050814 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m14:30:06.051497 [debug] [Thread-2 (]: SQL status: BEGIN in 0.025 seconds
[0m14:30:06.052122 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_encounter"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_encounter__dbt_tmp"
    
    
  as (
    select
    id as fhir_id,
    resource,
    resource ->> 'id'                                 as resource_id,
    resource ->> 'status'                             as status,
    resource -> 'class' ->> 'code'                    as class_code,
    resource -> 'type'  -> 0 -> 'coding' -> 0 ->> 'code'    as type_code,
    resource -> 'type'  -> 0 -> 'coding' -> 0 ->> 'display' as type_display,

    
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'subject' ->> 'reference', '^\w+/', ''))
 as patient_id,
    
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'participant' -> 0 -> 'individual' ->> 'reference', '^\w+/', ''))
 as practitioner_id,

    
  (nullif(resource -> 'period' ->> 'start', '')::timestamptz)
 as period_start,
    
  (nullif(resource -> 'period' ->> 'end', '')::timestamptz)
   as period_end,

    
  (nullif("lastUpdated", '')::timestamptz)
                    as lastUpdated_ts,
    _airbyte_extracted_at
<<<<<<< HEAD
from "data_warehouse"."airbyte"."encounter"
=======
from "data_warehouse"."airbyte"."encounter"
>>>>>>> c3960797835542a77251307755857b1b52335c67
  );
[0m14:30:06.052867 [debug] [Thread-4 (]: SQL status: BEGIN in 0.024 seconds
[0m14:30:06.053508 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:30:06.054248 [debug] [Thread-3 (]: SQL status: BEGIN in 0.026 seconds
[0m14:30:06.054871 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "======="
LINE 38: =======
         ^

[0m14:30:06.055705 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:30:06.056286 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_tmp"
    
    
  as (
    with src as (
    select
        id as fhir_id,
        resource,
        resource ->> 'id'                  as resource_id,
        resource -> 'meta' ->> 'versionId' as version_id,
        resource -> 'meta' ->> 'lastUpdated' as meta_last_updated,
        resource ->> 'gender'              as gender,
        resource ->> 'birthDate'           as birth_date,
        resource ->> 'active'              as active,

        
  (nullif("lastUpdated", '')::timestamptz)
 as lastUpdated_ts,   -- << quote the column
        _airbyte_extracted_at
    from "data_warehouse"."airbyte"."patient"
)
select * from src
  );
[0m14:30:06.056942 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:30:06.057538 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: ROLLBACK
[0m14:30:06.058133 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_tmp"
    
    
  as (
    with base as (
    select
        id as fhir_id,
        resource,
        resource ->> 'id'            as resource_id,
        resource ->> 'status'        as status,
        resource ->> 'questionnaire' as questionnaire_canonical,

        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'subject'   ->> 'reference', '^\w+/', ''))
 as patient_id,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'encounter' ->> 'reference', '^\w+/', ''))
 as encounter_id,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'author'    ->> 'reference', '^\w+/', ''))
 as author_id,

        
  (nullif(resource ->> 'authored', '')::timestamptz)
 as authored_ts,
        
  (nullif("lastUpdated", '')::timestamptz)
           as lastUpdated_ts,
        _airbyte_extracted_at
    from "data_warehouse"."airbyte"."questionnaire_response"
)
select * from base
  );
[0m14:30:06.058877 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_tmp"
    
    
  as (
    select
    id as fhir_id,
    resource,
    resource ->> 'id'                            as resource_id,
    resource -> 'name' -> 0 ->> 'family'         as family_name,
    resource -> 'name' -> 0 -> 'given' ->> 0     as given_name,
    resource -> 'telecom' -> 0 ->> 'value'       as phone_raw,

    
  (nullif("lastUpdated", '')::timestamptz)
        as lastUpdated_ts,   -- << quote the column
    _airbyte_extracted_at
from "data_warehouse"."airbyte"."practitioner"
  );
[0m14:30:06.059973 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: Close
[0m14:30:06.063093 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m14:30:06.069236 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m14:30:06.069892 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m14:30:06.072060 [debug] [Thread-1 (]: Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  syntax error at or near "======="
  LINE 38: =======
           ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql
[0m14:30:06.076104 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:30:06.080561 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:30:06.085776 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:30:06.088554 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_tmp" rename to "stg_patient"
[0m14:30:06.089102 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d5414650>]}
[0m14:30:06.089733 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_tmp" rename to "stg_practitioner"
[0m14:30:06.090292 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_tmp" rename to "stg_questionnaire_response"
[0m14:30:06.092014 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:30:06.091403 [error] [Thread-1 (]: 1 of 13 ERROR creating sql view model engage_analytics_stg.stg_encounter ....... [[31mERROR[0m in 0.17s]
[0m14:30:06.098174 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m14:30:06.098826 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m14:30:06.104822 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.stg_encounter
[0m14:30:06.115103 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: COMMIT
[0m14:30:06.117145 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: COMMIT
[0m14:30:06.118933 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: COMMIT
[0m14:30:06.119765 [debug] [Thread-1 (]: Began running node seed.opensrp_mh.score_map
[0m14:30:06.120605 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.stg_encounter' to be skipped because of status 'error'.  Reason: Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  syntax error at or near "======="
  LINE 38: =======
           ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql.
[0m14:30:06.121148 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:30:06.121818 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:30:06.122393 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:30:06.123246 [info ] [Thread-1 (]: 5 of 13 START seed file engage_analytics.score_map ............................. [RUN]
[0m14:30:06.124738 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: COMMIT
[0m14:30:06.125336 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: COMMIT
[0m14:30:06.125926 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: COMMIT
[0m14:30:06.126599 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_encounter, now seed.opensrp_mh.score_map)
[0m14:30:06.127455 [debug] [Thread-1 (]: Began compiling node seed.opensrp_mh.score_map
[0m14:30:06.127963 [debug] [Thread-1 (]: Began executing node seed.opensrp_mh.score_map
[0m14:30:06.133833 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m14:30:06.134391 [debug] [Thread-3 (]: SQL status: COMMIT in 0.007 seconds
[0m14:30:06.135014 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m14:30:06.148726 [debug] [Thread-4 (]: Applying DROP to: "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_backup"
[0m14:30:06.170083 [debug] [Thread-3 (]: Applying DROP to: "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_backup"
[0m14:30:06.178560 [debug] [Thread-2 (]: Applying DROP to: "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_backup"
[0m14:30:06.180837 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:30:06.187712 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:30:06.188654 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:30:06.189403 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:30:06.189995 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: BEGIN
[0m14:30:06.190526 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */
drop view if exists "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_backup" cascade
[0m14:30:06.191133 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */
drop view if exists "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_backup" cascade
[0m14:30:06.191681 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */
drop view if exists "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_backup" cascade
[0m14:30:06.192239 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:30:06.193704 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:30:06.194280 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:30:06.194860 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m14:30:06.198265 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: Close
[0m14:30:06.200225 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: Close
[0m14:30:06.202289 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: Close
[0m14:30:06.204247 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d018b920>]}
[0m14:30:06.203314 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d6e56960>]}
[0m14:30:06.205025 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d3392c30>]}
[0m14:30:06.205888 [info ] [Thread-2 (]: 2 of 13 OK created sql view model engage_analytics_stg.stg_patient ............. [[32mCREATE VIEW[0m in 0.29s]
[0m14:30:06.208566 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.stg_patient
[0m14:30:06.206852 [info ] [Thread-4 (]: 4 of 13 OK created sql view model engage_analytics_stg.stg_questionnaire_response  [[32mCREATE VIEW[0m in 0.28s]
[0m14:30:06.207748 [info ] [Thread-3 (]: 3 of 13 OK created sql view model engage_analytics_stg.stg_practitioner ........ [[32mCREATE VIEW[0m in 0.29s]
[0m14:30:06.209271 [debug] [Thread-2 (]: Began running node model.opensrp_mh.fact_encounter
[0m14:30:06.210120 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.stg_questionnaire_response
[0m14:30:06.211312 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.stg_practitioner
[0m14:30:06.211829 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m14:30:06.212997 [debug] [Thread-4 (]: Began running node model.opensrp_mh.dim_patient
[0m14:30:06.212388 [info ] [Thread-2 (]: 6 of 13 SKIP relation engage_analytics_mart.fact_encounter ..................... [[33mSKIP[0m]
[0m14:30:06.213975 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:30:06.216587 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "seed.opensrp_mh.score_map"} */
truncate table "data_warehouse"."engage_analytics"."score_map"
[0m14:30:06.215883 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.fact_encounter
[0m14:30:06.215284 [info ] [Thread-4 (]: 7 of 13 START sql view model engage_analytics_mart.dim_patient ................. [RUN]
[0m14:30:06.214613 [debug] [Thread-3 (]: Began running node model.opensrp_mh.dim_practitioner
[0m14:30:06.217285 [debug] [Thread-2 (]: Began running node model.opensrp_mh.int_qr_answers_long
[0m14:30:06.217792 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.fact_encounter' to be skipped because of status 'skipped'. 
[0m14:30:06.218349 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_questionnaire_response, now model.opensrp_mh.dim_patient)
[0m14:30:06.219112 [info ] [Thread-3 (]: 8 of 13 START sql view model engage_analytics_mart.dim_practitioner ............ [RUN]
[0m14:30:06.220565 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.003 seconds
[0m14:30:06.219875 [info ] [Thread-2 (]: 9 of 13 START sql view model engage_analytics_int.int_qr_answers_long .......... [RUN]
[0m14:30:06.221246 [debug] [Thread-4 (]: Began compiling node model.opensrp_mh.dim_patient
[0m14:30:06.221883 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_practitioner, now model.opensrp_mh.dim_practitioner)
[0m14:30:06.243058 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:30:06.243778 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_patient, now model.opensrp_mh.int_qr_answers_long)
[0m14:30:06.247713 [debug] [Thread-4 (]: Writing injected SQL for node "model.opensrp_mh.dim_patient"
[0m14:30:06.248502 [debug] [Thread-3 (]: Began compiling node model.opensrp_mh.dim_practitioner
[0m14:30:06.249094 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: 
          insert into "data_warehouse"."engage_analytics"."score_map" ("questionnaire_match", "link_id", "coding_code", "numeric_value") values
          (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m14:30:06.249703 [debug] [Thread-2 (]: Began compiling node model.opensrp_mh.int_qr_answers_long
[0m14:30:06.253759 [debug] [Thread-3 (]: Writing injected SQL for node "model.opensrp_mh.dim_practitioner"
[0m14:30:06.259925 [debug] [Thread-3 (]: Began executing node model.opensrp_mh.dim_practitioner
[0m14:30:06.258582 [debug] [Thread-2 (]: Writing injected SQL for node "model.opensrp_mh.int_qr_answers_long"
[0m14:30:06.259235 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.005 seconds
[0m14:30:06.254616 [debug] [Thread-4 (]: Began executing node model.opensrp_mh.dim_patient
[0m14:30:06.263778 [debug] [Thread-3 (]: Writing runtime sql for node "model.opensrp_mh.dim_practitioner"
[0m14:30:06.271821 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.opensrp_mh.score_map"
[0m14:30:06.272557 [debug] [Thread-2 (]: Began executing node model.opensrp_mh.int_qr_answers_long
[0m14:30:06.276583 [debug] [Thread-4 (]: Writing runtime sql for node "model.opensrp_mh.dim_patient"
[0m14:30:06.277839 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:30:06.279732 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: COMMIT
[0m14:30:06.286095 [debug] [Thread-2 (]: Writing runtime sql for node "model.opensrp_mh.int_qr_answers_long"
[0m14:30:06.286898 [debug] [Thread-3 (]: On model.opensrp_mh.dim_practitioner: BEGIN
[0m14:30:06.287514 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:30:06.288020 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:30:06.288726 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:30:06.289316 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: COMMIT
[0m14:30:06.289852 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:30:06.290386 [debug] [Thread-4 (]: On model.opensrp_mh.dim_patient: BEGIN
[0m14:30:06.291361 [debug] [Thread-2 (]: On model.opensrp_mh.int_qr_answers_long: BEGIN
[0m14:30:06.291941 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:30:06.292448 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:30:06.293051 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m14:30:06.294765 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: Close
[0m14:30:06.295915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d00efa70>]}
[0m14:30:06.296667 [info ] [Thread-1 (]: 5 of 13 OK loaded seed file engage_analytics.score_map ......................... [[32mINSERT 4[0m in 0.17s]
[0m14:30:06.297372 [debug] [Thread-1 (]: Finished running node seed.opensrp_mh.score_map
[0m14:30:06.310735 [debug] [Thread-3 (]: SQL status: BEGIN in 0.022 seconds
[0m14:30:06.311441 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:30:06.312001 [debug] [Thread-4 (]: SQL status: BEGIN in 0.020 seconds
[0m14:30:06.312537 [debug] [Thread-3 (]: On model.opensrp_mh.dim_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_practitioner"} */

  create view "data_warehouse"."engage_analytics_mart"."dim_practitioner__dbt_tmp"
    
    
  as (
    select
  pr.fhir_id as practitioner_id,
  coalesce(pr.given_name || ' ', '') || coalesce(pr.family_name,'') as practitioner_name,
  pr.phone_raw
from "data_warehouse"."engage_analytics_stg"."stg_practitioner" pr
  );
[0m14:30:06.313108 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:30:06.313717 [debug] [Thread-4 (]: On model.opensrp_mh.dim_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_patient"} */

  create view "data_warehouse"."engage_analytics_mart"."dim_patient__dbt_tmp"
    
    
  as (
    select
  p.fhir_id as patient_id,
  p.gender,
  (p.birth_date)::date as birth_date,
  (date_part('year', age((p.birth_date)::date)))::int as age_years,
  (p.active)::boolean as is_active
from "data_warehouse"."engage_analytics_stg"."stg_patient" p
  );
[0m14:30:06.314234 [debug] [Thread-2 (]: SQL status: BEGIN in 0.022 seconds
[0m14:30:06.314805 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:30:06.315288 [debug] [Thread-2 (]: On model.opensrp_mh.int_qr_answers_long: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_long"} */

  create view "data_warehouse"."engage_analytics_int"."int_qr_answers_long__dbt_tmp"
    
    
  as (
    with qr as (
  select * from "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response"
),
items as (
  select
    q.fhir_id as qr_id,
    q.patient_id,
    q.encounter_id,
    q.author_id,
    q.questionnaire_canonical,
    q.authored_ts,
    i ->> 'linkId' as link_id,
    i ->> 'text'   as item_text,
    a as answer
  from qr q
  left join lateral jsonb_array_elements(q.resource -> 'item') as i on true
  left join lateral jsonb_array_elements(coalesce(i->'answer','[]'::jsonb)) as a on true
),
answers as (
  select
    *,
    case
      when answer ? 'valueInteger' then (answer ->> 'valueInteger')::numeric
      when answer ? 'valueDecimal' then (answer ->> 'valueDecimal')::numeric
      when answer ? 'valueQuantity' then (answer -> 'valueQuantity' ->> 'value')::numeric
      else null
    end as value_num,
    answer -> 'valueCoding' ->> 'code'    as value_code,
    answer -> 'valueCoding' ->> 'display' as value_display,
    answer ->> 'valueString'              as value_string,
    answer ->> 'valueDate'                as value_date,
    answer ->> 'valueBoolean'             as value_boolean
  from items
)
select * from answers
  );
[0m14:30:06.316247 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:30:06.316743 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m14:30:06.320789 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:30:06.321353 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m14:30:06.325233 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:30:06.325815 [debug] [Thread-3 (]: On model.opensrp_mh.dim_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_practitioner"} */
alter table "data_warehouse"."engage_analytics_mart"."dim_practitioner__dbt_tmp" rename to "dim_practitioner"
[0m14:30:06.329825 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:30:06.330479 [debug] [Thread-4 (]: On model.opensrp_mh.dim_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_patient"} */
alter table "data_warehouse"."engage_analytics_mart"."dim_patient__dbt_tmp" rename to "dim_patient"
[0m14:30:06.331140 [debug] [Thread-2 (]: On model.opensrp_mh.int_qr_answers_long: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_long"} */
alter table "data_warehouse"."engage_analytics_int"."int_qr_answers_long__dbt_tmp" rename to "int_qr_answers_long"
[0m14:30:06.331768 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:30:06.333459 [debug] [Thread-3 (]: On model.opensrp_mh.dim_practitioner: COMMIT
[0m14:30:06.333993 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:30:06.334481 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:30:06.334906 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:30:06.336539 [debug] [Thread-2 (]: On model.opensrp_mh.int_qr_answers_long: COMMIT
[0m14:30:06.337114 [debug] [Thread-3 (]: On model.opensrp_mh.dim_practitioner: COMMIT
[0m14:30:06.338700 [debug] [Thread-4 (]: On model.opensrp_mh.dim_patient: COMMIT
[0m14:30:06.339219 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:30:06.339834 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:30:06.340301 [debug] [Thread-2 (]: On model.opensrp_mh.int_qr_answers_long: COMMIT
[0m14:30:06.340836 [debug] [Thread-4 (]: On model.opensrp_mh.dim_patient: COMMIT
[0m14:30:06.341322 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m14:30:06.344544 [debug] [Thread-3 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."dim_practitioner__dbt_backup"
[0m14:30:06.345179 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m14:30:06.345882 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:30:06.346321 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m14:30:06.349486 [debug] [Thread-4 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."dim_patient__dbt_backup"
[0m14:30:06.350049 [debug] [Thread-3 (]: On model.opensrp_mh.dim_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_practitioner"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."dim_practitioner__dbt_backup" cascade
[0m14:30:06.352851 [debug] [Thread-2 (]: Applying DROP to: "data_warehouse"."engage_analytics_int"."int_qr_answers_long__dbt_backup"
[0m14:30:06.353705 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:30:06.354621 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:30:06.355175 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:30:06.355687 [debug] [Thread-4 (]: On model.opensrp_mh.dim_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_patient"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."dim_patient__dbt_backup" cascade
[0m14:30:06.356204 [debug] [Thread-2 (]: On model.opensrp_mh.int_qr_answers_long: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_long"} */
drop view if exists "data_warehouse"."engage_analytics_int"."int_qr_answers_long__dbt_backup" cascade
[0m14:30:06.358016 [debug] [Thread-3 (]: On model.opensrp_mh.dim_practitioner: Close
[0m14:30:06.359132 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d0b853a0>]}
[0m14:30:06.359699 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:30:06.360176 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.002 seconds
[0m14:30:06.362918 [debug] [Thread-2 (]: On model.opensrp_mh.int_qr_answers_long: Close
[0m14:30:06.361017 [info ] [Thread-3 (]: 8 of 13 OK created sql view model engage_analytics_mart.dim_practitioner ....... [[32mCREATE VIEW[0m in 0.14s]
[0m14:30:06.365910 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.dim_practitioner
[0m14:30:06.364923 [debug] [Thread-4 (]: On model.opensrp_mh.dim_patient: Close
[0m14:30:06.366669 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d007fb30>]}
[0m14:30:06.368686 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d0b432f0>]}
[0m14:30:06.367904 [info ] [Thread-2 (]: 9 of 13 OK created sql view model engage_analytics_int.int_qr_answers_long ..... [[32mCREATE VIEW[0m in 0.12s]
[0m14:30:06.369700 [info ] [Thread-4 (]: 7 of 13 OK created sql view model engage_analytics_mart.dim_patient ............ [[32mCREATE VIEW[0m in 0.15s]
[0m14:30:06.370538 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.int_qr_answers_long
[0m14:30:06.371223 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.dim_patient
[0m14:30:06.372346 [debug] [Thread-1 (]: Began running node model.opensrp_mh.fact_qr_latest_scores
[0m14:30:06.372862 [debug] [Thread-3 (]: Began running node model.opensrp_mh.int_qr_answers_scored
[0m14:30:06.373375 [debug] [Thread-2 (]: Began running node model.opensrp_mh.core_counts
[0m14:30:06.374497 [debug] [Thread-4 (]: Began running node model.opensrp_mh.patients_no_followup
[0m14:30:06.373987 [info ] [Thread-1 (]: 10 of 13 START sql view model engage_analytics_mart.fact_qr_latest_scores ...... [RUN]
[0m14:30:06.375336 [info ] [Thread-3 (]: 11 of 13 START sql view model engage_analytics_int.int_qr_answers_scored ....... [RUN]
[0m14:30:06.375994 [info ] [Thread-2 (]: 12 of 13 SKIP relation engage_analytics_mart.core_counts ....................... [[33mSKIP[0m]
[0m14:30:06.376629 [info ] [Thread-4 (]: 13 of 13 SKIP relation engage_analytics_mart.patients_no_followup .............. [[33mSKIP[0m]
[0m14:30:06.377318 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.opensrp_mh.score_map, now model.opensrp_mh.fact_qr_latest_scores)
[0m14:30:06.377911 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.dim_practitioner, now model.opensrp_mh.int_qr_answers_scored)
[0m14:30:06.378479 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.core_counts
[0m14:30:06.379008 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.patients_no_followup
[0m14:30:06.379537 [debug] [Thread-1 (]: Began compiling node model.opensrp_mh.fact_qr_latest_scores
[0m14:30:06.380021 [debug] [Thread-3 (]: Began compiling node model.opensrp_mh.int_qr_answers_scored
[0m14:30:06.380533 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.core_counts' to be skipped because of status 'skipped'. 
[0m14:30:06.384565 [debug] [Thread-1 (]: Writing injected SQL for node "model.opensrp_mh.fact_qr_latest_scores"
[0m14:30:06.388753 [debug] [Thread-3 (]: Writing injected SQL for node "model.opensrp_mh.int_qr_answers_scored"
[0m14:30:06.389460 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.patients_no_followup' to be skipped because of status 'skipped'. 
[0m14:30:06.390466 [debug] [Thread-1 (]: Began executing node model.opensrp_mh.fact_qr_latest_scores
[0m14:30:06.396274 [debug] [Thread-3 (]: Began executing node model.opensrp_mh.int_qr_answers_scored
[0m14:30:06.398003 [debug] [Thread-1 (]: Writing runtime sql for node "model.opensrp_mh.fact_qr_latest_scores"
[0m14:30:06.401777 [debug] [Thread-3 (]: Writing runtime sql for node "model.opensrp_mh.int_qr_answers_scored"
[0m14:30:06.402767 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:30:06.403340 [debug] [Thread-1 (]: On model.opensrp_mh.fact_qr_latest_scores: BEGIN
[0m14:30:06.403821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:30:06.404355 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_scored"
[0m14:30:06.405019 [debug] [Thread-3 (]: On model.opensrp_mh.int_qr_answers_scored: BEGIN
[0m14:30:06.405460 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:30:06.420045 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m14:30:06.420719 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m14:30:06.421324 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:30:06.421866 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_scored"
[0m14:30:06.422408 [debug] [Thread-1 (]: On model.opensrp_mh.fact_qr_latest_scores: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_qr_latest_scores"} */

  create view "data_warehouse"."engage_analytics_mart"."fact_qr_latest_scores__dbt_tmp"
    
    
  as (
    -- Example: compute latest numeric totals per questionnaire (e.g., PHQ-9 / GAD-7 / PCL-5 8)
-- Assumes numeric answers; if coded answers are used, create a mapping table and join to resolve scores.
with scored as (
  select
    patient_id,
    questionnaire_canonical,
    authored_ts,
    sum(coalesce(value_num, 0)) as total_score
  from "data_warehouse"."engage_analytics_int"."int_qr_answers_long"
  group by 1,2,3
),
latest as (
  select distinct on (patient_id, questionnaire_canonical)
    patient_id,
    questionnaire_canonical,
    authored_ts,
    total_score
  from scored
  order by patient_id, questionnaire_canonical, authored_ts desc
)
select * from latest
  );
[0m14:30:06.423026 [debug] [Thread-3 (]: On model.opensrp_mh.int_qr_answers_scored: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_scored"} */

  create view "data_warehouse"."engage_analytics_int"."int_qr_answers_scored__dbt_tmp"
    
    
  as (
    with a as (
  select * from "data_warehouse"."engage_analytics_int"."int_qr_answers_long"
),
map as (
  select * from "data_warehouse"."engage_analytics"."score_map"
)
select
  a.*,
  coalesce(
    a.value_num,
    case when a.value_code is not null then
      (select m.numeric_value from map m
       where a.link_id = m.link_id
         and a.value_code = m.coding_code
         and a.questionnaire_canonical ilike '%' || m.questionnaire_match || '%'
       limit 1)
    end
  ) as score_value
from a
  );
[0m14:30:06.425386 [debug] [Thread-3 (]: Postgres adapter: Postgres error: operator does not exist: text = integer
LINE 20:          and a.value_code = m.coding_code
                                   ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[0m14:30:06.425952 [debug] [Thread-3 (]: On model.opensrp_mh.int_qr_answers_scored: ROLLBACK
[0m14:30:06.426459 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:30:06.430704 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:30:06.431329 [debug] [Thread-3 (]: On model.opensrp_mh.int_qr_answers_scored: Close
[0m14:30:06.431893 [debug] [Thread-1 (]: On model.opensrp_mh.fact_qr_latest_scores: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_qr_latest_scores"} */
alter table "data_warehouse"."engage_analytics_mart"."fact_qr_latest_scores__dbt_tmp" rename to "fact_qr_latest_scores"
[0m14:30:06.433983 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:30:06.435807 [debug] [Thread-1 (]: On model.opensrp_mh.fact_qr_latest_scores: COMMIT
[0m14:30:06.436405 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:30:06.436921 [debug] [Thread-1 (]: On model.opensrp_mh.fact_qr_latest_scores: COMMIT
[0m14:30:06.438762 [debug] [Thread-3 (]: Database Error in model int_qr_answers_scored (models/intermediate/int_qr_answers_scored.sql)
  operator does not exist: text = integer
  LINE 20:          and a.value_code = m.coding_code
                                     ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/opensrp_mh/models/intermediate/int_qr_answers_scored.sql
[0m14:30:06.439330 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m14:30:06.439967 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d022c320>]}
[0m14:30:06.442995 [debug] [Thread-1 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."fact_qr_latest_scores__dbt_backup"
[0m14:30:06.444696 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:30:06.443908 [error] [Thread-3 (]: 11 of 13 ERROR creating sql view model engage_analytics_int.int_qr_answers_scored  [[31mERROR[0m in 0.06s]
[0m14:30:06.445360 [debug] [Thread-1 (]: On model.opensrp_mh.fact_qr_latest_scores: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_qr_latest_scores"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."fact_qr_latest_scores__dbt_backup" cascade
[0m14:30:06.446100 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.int_qr_answers_scored
[0m14:30:06.446951 [debug] [Thread-7 (]: Marking all children of 'model.opensrp_mh.int_qr_answers_scored' to be skipped because of status 'error'.  Reason: Database Error in model int_qr_answers_scored (models/intermediate/int_qr_answers_scored.sql)
  operator does not exist: text = integer
  LINE 20:          and a.value_code = m.coding_code
                                     ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/opensrp_mh/models/intermediate/int_qr_answers_scored.sql.
[0m14:30:06.447564 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:30:06.449584 [debug] [Thread-1 (]: On model.opensrp_mh.fact_qr_latest_scores: Close
[0m14:30:06.450500 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0263acde-32d8-44c3-9eca-fbb22908705e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d011c9b0>]}
[0m14:30:06.451326 [info ] [Thread-1 (]: 10 of 13 OK created sql view model engage_analytics_mart.fact_qr_latest_scores . [[32mCREATE VIEW[0m in 0.07s]
[0m14:30:06.452059 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.fact_qr_latest_scores
[0m14:30:06.453814 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:06.454247 [debug] [MainThread]: On master: BEGIN
[0m14:30:06.454615 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:30:06.470120 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m14:30:06.470709 [debug] [MainThread]: On master: COMMIT
[0m14:30:06.471092 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:06.471433 [debug] [MainThread]: On master: COMMIT
[0m14:30:06.472180 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:30:06.472608 [debug] [MainThread]: On master: Close
[0m14:30:06.473321 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:30:06.473776 [debug] [MainThread]: Connection 'model.opensrp_mh.int_qr_answers_scored' was properly closed.
[0m14:30:06.474059 [debug] [MainThread]: Connection 'model.opensrp_mh.fact_qr_latest_scores' was properly closed.
[0m14:30:06.474321 [debug] [MainThread]: Connection 'model.opensrp_mh.int_qr_answers_long' was properly closed.
[0m14:30:06.474622 [debug] [MainThread]: Connection 'model.opensrp_mh.dim_patient' was properly closed.
[0m14:30:06.475069 [info ] [MainThread]: 
[0m14:30:06.475504 [info ] [MainThread]: Finished running 1 seed, 12 view models in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m14:30:06.477748 [debug] [MainThread]: Command end result
[0m14:30:06.512785 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m14:30:06.515499 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m14:30:06.523311 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/run_results.json
[0m14:30:06.523845 [info ] [MainThread]: 
[0m14:30:06.524331 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m14:30:06.524781 [info ] [MainThread]: 
[0m14:30:06.525264 [error] [MainThread]: [31mFailure in model stg_encounter (models/staging/stg_encounter.sql)[0m
[0m14:30:06.525753 [error] [MainThread]:   Database Error in model stg_encounter (models/staging/stg_encounter.sql)
  syntax error at or near "======="
  LINE 38: =======
           ^
  compiled code at target/run/opensrp_mh/models/staging/stg_encounter.sql
[0m14:30:06.526124 [info ] [MainThread]: 
[0m14:30:06.526585 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/staging/stg_encounter.sql
[0m14:30:06.527014 [info ] [MainThread]: 
[0m14:30:06.527516 [error] [MainThread]: [31mFailure in model int_qr_answers_scored (models/intermediate/int_qr_answers_scored.sql)[0m
[0m14:30:06.527999 [error] [MainThread]:   Database Error in model int_qr_answers_scored (models/intermediate/int_qr_answers_scored.sql)
  operator does not exist: text = integer
  LINE 20:          and a.value_code = m.coding_code
                                     ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/opensrp_mh/models/intermediate/int_qr_answers_scored.sql
[0m14:30:06.528360 [info ] [MainThread]: 
[0m14:30:06.528825 [info ] [MainThread]:   compiled code at target/compiled/opensrp_mh/models/intermediate/int_qr_answers_scored.sql
[0m14:30:06.529209 [info ] [MainThread]: 
[0m14:30:06.529620 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=2 SKIP=3 NO-OP=0 TOTAL=13
[0m14:30:06.530832 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.2379875, "process_in_blocks": "0", "process_kernel_time": 0.321714, "process_mem_max_rss": "130044", "process_out_blocks": "4176", "process_user_time": 3.75668}
[0m14:30:06.531364 [debug] [MainThread]: Command `dbt build` failed at 14:30:06.531254 after 2.24 seconds
[0m14:30:06.531845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d4573bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d3469f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xef56d4ce6120>]}
[0m14:30:06.532270 [debug] [MainThread]: Flushing usage events
[0m14:30:06.584792 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:47:26.731975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b990026c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b99797740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b99795490>]}


============================== 14:47:26.736209 | 78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd ==============================
[0m14:47:26.736209 [info ] [MainThread]: Running with dbt=1.10.9
[0m14:47:26.736915 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'static_parser': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'indirect_selection': 'eager', 'profiles_dir': '/home/dbt/.dbt', 'write_json': 'True', 'invocation_command': 'dbt seed --full-refresh', 'target_path': 'None', 'introspect': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'fail_fast': 'False', 'printer_width': '80', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'empty': 'None', 'use_colors': 'True', 'no_print': 'None', 'use_experimental_parser': 'False'}
[0m14:47:26.983670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b987d4230>]}
[0m14:47:27.090754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b9903faa0>]}
[0m14:47:27.091802 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:47:27.192655 [debug] [MainThread]: checksum: 2980a21a4fc584f27f03453e4d43c980470d5de79693c5ce0bc2b462a52f088e, vars: {}, profile: , target: prod, version: 1.10.9
[0m14:47:27.309583 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:47:27.310178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b978514c0>]}
[0m14:47:29.243293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b96f19fd0>]}
[0m14:47:29.337876 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m14:47:29.340498 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m14:47:29.357534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b97220bc0>]}
[0m14:47:29.358177 [info ] [MainThread]: Found 12 models, 1 seed, 11 sources, 575 macros
[0m14:47:29.358681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b96f09bb0>]}
[0m14:47:29.361025 [info ] [MainThread]: 
[0m14:47:29.361526 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m14:47:29.361901 [info ] [MainThread]: 
[0m14:47:29.362532 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:47:29.363708 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:47:29.402449 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:47:29.402980 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:47:29.403316 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:47:29.422788 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.019 seconds
[0m14:47:29.424637 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:47:29.430840 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_int)
[0m14:47:29.431743 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse_engage_analytics_stg'
[0m14:47:29.437765 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse_engage_analytics_mart'
[0m14:47:29.440716 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m14:47:29.441486 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse_engage_analytics'
[0m14:47:29.446196 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m14:47:29.557108 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m14:47:29.557695 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: BEGIN
[0m14:47:29.560138 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m14:47:29.560658 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: BEGIN
[0m14:47:29.561255 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: BEGIN
[0m14:47:29.561704 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:47:29.562119 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: BEGIN
[0m14:47:29.562528 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:47:29.562927 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:47:29.563527 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:47:29.585348 [debug] [ThreadPool]: SQL status: BEGIN in 0.022 seconds
[0m14:47:29.585918 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m14:47:29.586287 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics'
  
[0m14:47:29.588298 [debug] [ThreadPool]: SQL status: BEGIN in 0.027 seconds
[0m14:47:29.588886 [debug] [ThreadPool]: SQL status: BEGIN in 0.026 seconds
[0m14:47:29.589287 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m14:47:29.589681 [debug] [ThreadPool]: SQL status: BEGIN in 0.027 seconds
[0m14:47:29.590036 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m14:47:29.590442 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m14:47:29.590897 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_int"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_int'
  
[0m14:47:29.591337 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m14:47:29.593073 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: ROLLBACK
[0m14:47:29.593588 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_stg"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_stg'
  
[0m14:47:29.594195 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_mart"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_mart'
  
[0m14:47:29.595075 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: Close
[0m14:47:29.597628 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m14:47:29.598044 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m14:47:29.599664 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: ROLLBACK
[0m14:47:29.601351 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: ROLLBACK
[0m14:47:29.601914 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.007 seconds
[0m14:47:29.602309 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: Close
[0m14:47:29.604032 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: ROLLBACK
[0m14:47:29.604526 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: Close
[0m14:47:29.606520 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: Close
[0m14:47:29.613865 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:29.614363 [debug] [MainThread]: On master: BEGIN
[0m14:47:29.614756 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:47:29.630138 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m14:47:29.630705 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:29.631165 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:47:29.653769 [debug] [MainThread]: SQL status: SELECT 7 in 0.022 seconds
[0m14:47:29.656545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b963151c0>]}
[0m14:47:29.657132 [debug] [MainThread]: On master: ROLLBACK
[0m14:47:29.658027 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:29.658463 [debug] [MainThread]: On master: BEGIN
[0m14:47:29.659698 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:47:29.660078 [debug] [MainThread]: On master: COMMIT
[0m14:47:29.660487 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:29.660860 [debug] [MainThread]: On master: COMMIT
[0m14:47:29.661597 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:47:29.662018 [debug] [MainThread]: On master: Close
[0m14:47:29.665322 [debug] [Thread-1 (]: Began running node seed.opensrp_mh.score_map
[0m14:47:29.666074 [info ] [Thread-1 (]: 1 of 1 START seed file engage_analytics.score_map .............................. [RUN]
[0m14:47:29.666721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_mart, now seed.opensrp_mh.score_map)
[0m14:47:29.667161 [debug] [Thread-1 (]: Began compiling node seed.opensrp_mh.score_map
[0m14:47:29.667596 [debug] [Thread-1 (]: Began executing node seed.opensrp_mh.score_map
[0m14:47:29.707144 [debug] [Thread-1 (]: Applying DROP to: "data_warehouse"."engage_analytics"."score_map"
[0m14:47:29.714611 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:47:29.715184 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "seed.opensrp_mh.score_map"} */
drop table if exists "data_warehouse"."engage_analytics"."score_map" cascade
[0m14:47:29.715606 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:47:29.732215 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.016 seconds
[0m14:47:29.741510 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:47:29.742076 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: BEGIN
[0m14:47:29.743220 [debug] [Thread-1 (]: SQL status: BEGIN in 0.001 seconds
[0m14:47:29.743693 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:47:29.744083 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "seed.opensrp_mh.score_map"} */

    create table "data_warehouse"."engage_analytics"."score_map" ("questionnaire_match" text,"link_id" text,"coding_code" text,"numeric_value" integer)
  
[0m14:47:29.748768 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 0.004 seconds
[0m14:47:29.768449 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:47:29.769026 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: 
          insert into "data_warehouse"."engage_analytics"."score_map" ("questionnaire_match", "link_id", "coding_code", "numeric_value") values
          (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m14:47:29.770438 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.001 seconds
[0m14:47:29.777239 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.opensrp_mh.score_map"
[0m14:47:29.801399 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: COMMIT
[0m14:47:29.802005 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:47:29.802397 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: COMMIT
[0m14:47:29.804657 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m14:47:29.806921 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: Close
[0m14:47:29.809029 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78f05a14-32e4-4c0e-9ffe-a93f85bfa2dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b96f0b320>]}
[0m14:47:29.809712 [info ] [Thread-1 (]: 1 of 1 OK loaded seed file engage_analytics.score_map .......................... [[32mCREATE 4[0m in 0.14s]
[0m14:47:29.810400 [debug] [Thread-1 (]: Finished running node seed.opensrp_mh.score_map
[0m14:47:29.812132 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:29.812561 [debug] [MainThread]: On master: BEGIN
[0m14:47:29.812899 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:47:29.828727 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m14:47:29.829257 [debug] [MainThread]: On master: COMMIT
[0m14:47:29.829674 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:29.830012 [debug] [MainThread]: On master: COMMIT
[0m14:47:29.830739 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:47:29.831140 [debug] [MainThread]: On master: Close
[0m14:47:29.831934 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:47:29.832341 [debug] [MainThread]: Connection 'list_data_warehouse_engage_analytics_int' was properly closed.
[0m14:47:29.832704 [debug] [MainThread]: Connection 'list_data_warehouse_engage_analytics_stg' was properly closed.
[0m14:47:29.832993 [debug] [MainThread]: Connection 'seed.opensrp_mh.score_map' was properly closed.
[0m14:47:29.833266 [debug] [MainThread]: Connection 'list_data_warehouse_engage_analytics' was properly closed.
[0m14:47:29.833627 [info ] [MainThread]: 
[0m14:47:29.834045 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m14:47:29.834908 [debug] [MainThread]: Command end result
[0m14:47:29.870681 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m14:47:29.873463 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m14:47:29.880097 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/run_results.json
[0m14:47:29.880592 [info ] [MainThread]: 
[0m14:47:29.881107 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:47:29.881538 [info ] [MainThread]: 
[0m14:47:29.881972 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m14:47:29.883102 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 3.2397041, "process_in_blocks": "0", "process_kernel_time": 0.268591, "process_mem_max_rss": "130916", "process_out_blocks": "3896", "process_user_time": 4.768734}
[0m14:47:29.883673 [debug] [MainThread]: Command `dbt seed` succeeded at 14:47:29.883550 after 3.24 seconds
[0m14:47:29.884094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b96f29760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b96f94230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe30b97152cf0>]}
[0m14:47:29.884550 [debug] [MainThread]: Flushing usage events
[0m14:47:29.937347 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:47:43.142222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf22d550f0aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf22d54ca87a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf22d54caa510>]}


============================== 14:47:43.146283 | 63f95329-a3bf-47a4-8bd6-4b715c349b8d ==============================
[0m14:47:43.146283 [info ] [MainThread]: Running with dbt=1.10.9
[0m14:47:43.147044 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'warn_error': 'None', 'target_path': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_colors': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'empty': 'None', 'printer_width': '80', 'partial_parse': 'True', 'log_format': 'default', 'invocation_command': 'dbt clean', 'indirect_selection': 'eager', 'version_check': 'True', 'introspect': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'profiles_dir': '/home/dbt/.dbt'}
[0m14:47:43.325669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '63f95329-a3bf-47a4-8bd6-4b715c349b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf22d54be1820>]}
[0m14:47:43.338766 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.2866999, "process_in_blocks": "0", "process_kernel_time": 0.207153, "process_mem_max_rss": "101608", "process_out_blocks": "0", "process_user_time": 1.997735}
[0m14:47:43.339367 [debug] [MainThread]: Command `dbt clean` succeeded at 14:47:43.339248 after 0.29 seconds
[0m14:47:43.339817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf22d550f0aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf22d55ba5d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xf22d54b9e150>]}
[0m14:47:43.340237 [debug] [MainThread]: Flushing usage events
[0m14:47:43.389774 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:47:58.569204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fa7b1b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fa7b10d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fa7b13d0>]}


============================== 14:47:58.573544 | dbf349e1-36a2-4608-8b19-7062a831d6ff ==============================
[0m14:47:58.573544 [info ] [MainThread]: Running with dbt=1.10.9
[0m14:47:58.574321 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'target_path': 'None', 'profiles_dir': '/home/dbt/.dbt', 'write_json': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'empty': 'None', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'invocation_command': 'dbt deps', 'warn_error': 'None', 'quiet': 'False', 'use_colors': 'True', 'log_format': 'default', 'version_check': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'no_print': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:47:58.757075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbf349e1-36a2-4608-8b19-7062a831d6ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fa6caf90>]}
[0m14:47:58.785561 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-h2908_gj'
[0m14:47:58.786122 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m14:47:58.838086 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m14:47:58.840554 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m14:47:58.890511 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m14:47:58.896718 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json
[0m14:47:58.945927 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json 200
[0m14:47:58.950290 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m14:47:59.043904 [info ] [MainThread]: Installed from version 1.3.0
[0m14:47:59.044462 [info ] [MainThread]: Up to date!
[0m14:47:59.044919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'dbf349e1-36a2-4608-8b19-7062a831d6ff', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fb5b6f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fb5b6810>]}
[0m14:47:59.045364 [info ] [MainThread]: Installing dbt-labs/codegen
[0m14:47:59.113500 [info ] [MainThread]: Installed from version 0.13.1
[0m14:47:59.114029 [info ] [MainThread]: Up to date!
[0m14:47:59.114495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'dbf349e1-36a2-4608-8b19-7062a831d6ff', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fa34b8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fa34b2f0>]}
[0m14:47:59.115978 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.63642013, "process_in_blocks": "0", "process_kernel_time": 0.242367, "process_mem_max_rss": "103324", "process_out_blocks": "3088", "process_user_time": 2.255057}
[0m14:47:59.116573 [debug] [MainThread]: Command `dbt deps` succeeded at 14:47:59.116451 after 0.64 seconds
[0m14:47:59.116978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fae5d100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fa586f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xe9c9fa4c6f30>]}
[0m14:47:59.117409 [debug] [MainThread]: Flushing usage events
[0m14:47:59.164732 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:48:05.064717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba7d1f770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba7e75f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba7d85130>]}


============================== 14:48:05.068982 | d6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196 ==============================
[0m14:48:05.068982 [info ] [MainThread]: Running with dbt=1.10.9
[0m14:48:05.069708 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'quiet': 'False', 'invocation_command': 'dbt build', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'profiles_dir': '/home/dbt/.dbt', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'log_format': 'default', 'log_path': '/home/dbt/fhir-analytics-repo/engage-analytics/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'partial_parse': 'True', 'empty': 'False', 'static_parser': 'True', 'no_print': 'None', 'write_json': 'True', 'debug': 'False'}
[0m14:48:05.325542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba74cc0e0>]}
[0m14:48:05.435565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba9118800>]}
[0m14:48:05.436613 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:48:05.539450 [debug] [MainThread]: checksum: 2980a21a4fc584f27f03453e4d43c980470d5de79693c5ce0bc2b462a52f088e, vars: {}, profile: , target: prod, version: 1.10.9
[0m14:48:05.540368 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:48:05.540889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba84b69f0>]}
[0m14:48:07.538113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba5e15df0>]}
[0m14:48:07.635679 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m14:48:07.638131 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m14:48:07.668591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba5c85700>]}
[0m14:48:07.669248 [info ] [MainThread]: Found 12 models, 1 seed, 11 sources, 575 macros
[0m14:48:07.672612 [info ] [MainThread]: 
[0m14:48:07.673157 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m14:48:07.673535 [info ] [MainThread]: 
[0m14:48:07.674135 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:48:07.679734 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:48:07.685807 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:48:07.702882 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:48:07.703832 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_warehouse'
[0m14:48:07.849979 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:48:07.850660 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:48:07.851126 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:48:07.851544 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:48:07.851932 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse"
[0m14:48:07.852380 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:48:07.852856 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:07.853296 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:48:07.853760 [debug] [ThreadPool]: On list_data_warehouse: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m14:48:07.854194 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:07.854929 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:07.855564 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:07.881167 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.027 seconds
[0m14:48:07.881870 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.029 seconds
[0m14:48:07.883670 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:48:07.884120 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.029 seconds
[0m14:48:07.884557 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.030 seconds
[0m14:48:07.886204 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:48:07.888192 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:48:07.890390 [debug] [ThreadPool]: On list_data_warehouse: Close
[0m14:48:07.894069 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_stg)
[0m14:48:07.894853 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics)
[0m14:48:07.895621 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_mart)
[0m14:48:07.901581 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_warehouse, now list_data_warehouse_engage_analytics_int)
[0m14:48:07.904637 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m14:48:07.907455 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m14:48:07.910094 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m14:48:07.912778 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m14:48:07.913339 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: BEGIN
[0m14:48:07.913841 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: BEGIN
[0m14:48:07.914297 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: BEGIN
[0m14:48:07.914794 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: BEGIN
[0m14:48:07.915233 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:07.915705 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:07.916133 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:07.916570 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:07.939411 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m14:48:07.940134 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m14:48:07.940660 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m14:48:07.941060 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_stg"
[0m14:48:07.941600 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_mart"
[0m14:48:07.942103 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics_int"
[0m14:48:07.942523 [debug] [ThreadPool]: SQL status: BEGIN in 0.027 seconds
[0m14:48:07.943017 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_stg"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_stg'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_stg'
  
[0m14:48:07.943548 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_mart"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_mart'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_mart'
  
[0m14:48:07.944066 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics_int"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics_int'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics_int'
  
[0m14:48:07.944556 [debug] [ThreadPool]: Using postgres connection "list_data_warehouse_engage_analytics"
[0m14:48:07.945320 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "list_data_warehouse_engage_analytics"} */
select
      'data_warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'engage_analytics'
    union all
    select
      'data_warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'engage_analytics'
  
[0m14:48:07.948748 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.004 seconds
[0m14:48:07.949315 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m14:48:07.953602 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: ROLLBACK
[0m14:48:07.954205 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.008 seconds
[0m14:48:07.954664 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.010 seconds
[0m14:48:07.956225 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: ROLLBACK
[0m14:48:07.957997 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: ROLLBACK
[0m14:48:07.958485 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_stg: Close
[0m14:48:07.960090 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: ROLLBACK
[0m14:48:07.962005 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics: Close
[0m14:48:07.962926 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_mart: Close
[0m14:48:07.962559 [debug] [ThreadPool]: On list_data_warehouse_engage_analytics_int: Close
[0m14:48:07.971323 [debug] [MainThread]: Using postgres connection "master"
[0m14:48:07.971835 [debug] [MainThread]: On master: BEGIN
[0m14:48:07.972151 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:48:07.989631 [debug] [MainThread]: SQL status: BEGIN in 0.017 seconds
[0m14:48:07.990153 [debug] [MainThread]: Using postgres connection "master"
[0m14:48:07.990628 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:48:08.013145 [debug] [MainThread]: SQL status: SELECT 7 in 0.022 seconds
[0m14:48:08.016770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba5d43890>]}
[0m14:48:08.017390 [debug] [MainThread]: On master: ROLLBACK
[0m14:48:08.018466 [debug] [MainThread]: Using postgres connection "master"
[0m14:48:08.018927 [debug] [MainThread]: On master: BEGIN
[0m14:48:08.020225 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:48:08.020693 [debug] [MainThread]: On master: COMMIT
[0m14:48:08.021075 [debug] [MainThread]: Using postgres connection "master"
[0m14:48:08.021563 [debug] [MainThread]: On master: COMMIT
[0m14:48:08.022323 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:48:08.022791 [debug] [MainThread]: On master: Close
[0m14:48:08.026658 [debug] [Thread-1 (]: Began running node model.opensrp_mh.stg_encounter
[0m14:48:08.027312 [debug] [Thread-2 (]: Began running node model.opensrp_mh.stg_patient
[0m14:48:08.027961 [debug] [Thread-3 (]: Began running node model.opensrp_mh.stg_practitioner
[0m14:48:08.029174 [debug] [Thread-4 (]: Began running node model.opensrp_mh.stg_questionnaire_response
[0m14:48:08.028690 [info ] [Thread-1 (]: 1 of 13 START sql view model engage_analytics_stg.stg_encounter ................ [RUN]
[0m14:48:08.029991 [info ] [Thread-2 (]: 2 of 13 START sql view model engage_analytics_stg.stg_patient .................. [RUN]
[0m14:48:08.030893 [info ] [Thread-3 (]: 3 of 13 START sql view model engage_analytics_stg.stg_practitioner ............. [RUN]
[0m14:48:08.031914 [info ] [Thread-4 (]: 4 of 13 START sql view model engage_analytics_stg.stg_questionnaire_response ... [RUN]
[0m14:48:08.034810 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_stg, now model.opensrp_mh.stg_questionnaire_response)
[0m14:48:08.034176 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics, now model.opensrp_mh.stg_practitioner)
[0m14:48:08.033585 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_mart, now model.opensrp_mh.stg_patient)
[0m14:48:08.032874 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_warehouse_engage_analytics_int, now model.opensrp_mh.stg_encounter)
[0m14:48:08.035360 [debug] [Thread-4 (]: Began compiling node model.opensrp_mh.stg_questionnaire_response
[0m14:48:08.035938 [debug] [Thread-3 (]: Began compiling node model.opensrp_mh.stg_practitioner
[0m14:48:08.036529 [debug] [Thread-2 (]: Began compiling node model.opensrp_mh.stg_patient
[0m14:48:08.037063 [debug] [Thread-1 (]: Began compiling node model.opensrp_mh.stg_encounter
[0m14:48:08.048025 [debug] [Thread-4 (]: Writing injected SQL for node "model.opensrp_mh.stg_questionnaire_response"
[0m14:48:08.052366 [debug] [Thread-3 (]: Writing injected SQL for node "model.opensrp_mh.stg_practitioner"
[0m14:48:08.057003 [debug] [Thread-2 (]: Writing injected SQL for node "model.opensrp_mh.stg_patient"
[0m14:48:08.062257 [debug] [Thread-1 (]: Writing injected SQL for node "model.opensrp_mh.stg_encounter"
[0m14:48:08.064177 [debug] [Thread-3 (]: Began executing node model.opensrp_mh.stg_practitioner
[0m14:48:08.064862 [debug] [Thread-4 (]: Began executing node model.opensrp_mh.stg_questionnaire_response
[0m14:48:08.086336 [debug] [Thread-2 (]: Began executing node model.opensrp_mh.stg_patient
[0m14:48:08.129552 [debug] [Thread-1 (]: Began executing node model.opensrp_mh.stg_encounter
[0m14:48:08.151964 [debug] [Thread-2 (]: Writing runtime sql for node "model.opensrp_mh.stg_patient"
[0m14:48:08.155144 [debug] [Thread-3 (]: Writing runtime sql for node "model.opensrp_mh.stg_practitioner"
[0m14:48:08.159662 [debug] [Thread-1 (]: Writing runtime sql for node "model.opensrp_mh.stg_encounter"
[0m14:48:08.150226 [debug] [Thread-4 (]: Writing runtime sql for node "model.opensrp_mh.stg_questionnaire_response"
[0m14:48:08.161805 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m14:48:08.162353 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:48:08.164280 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: BEGIN
[0m14:48:08.163716 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: BEGIN
[0m14:48:08.163068 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:48:08.164853 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:48:08.165346 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:48:08.165919 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:08.166461 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: BEGIN
[0m14:48:08.168001 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:48:08.166995 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: BEGIN
[0m14:48:08.168861 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:48:08.188401 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m14:48:08.189035 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m14:48:08.189564 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_encounter"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_encounter__dbt_tmp"
    
    
  as (
    select
    id as fhir_id,
    resource,
    resource ->> 'id'                                 as resource_id,
    resource ->> 'status'                             as status,
    resource -> 'class' ->> 'code'                    as class_code,
    resource -> 'type'  -> 0 -> 'coding' -> 0 ->> 'code'    as type_code,
    resource -> 'type'  -> 0 -> 'coding' -> 0 ->> 'display' as type_display,

    
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'subject' ->> 'reference', '^\w+/', ''))
 as patient_id,
    
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'participant' -> 0 -> 'individual' ->> 'reference', '^\w+/', ''))
 as practitioner_id,

    
  (nullif(resource -> 'period' ->> 'start', '')::timestamptz)
 as period_start,
    
  (nullif(resource -> 'period' ->> 'end', '')::timestamptz)
   as period_end,

    
  (nullif("lastUpdated", '')::timestamptz)
                    as lastUpdated_ts,
    _airbyte_extracted_at
from "data_warehouse"."airbyte"."encounter"
  );
[0m14:48:08.190168 [debug] [Thread-2 (]: SQL status: BEGIN in 0.022 seconds
[0m14:48:08.190765 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:48:08.191220 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_tmp"
    
    
  as (
    with src as (
    select
        id as fhir_id,
        resource,
        resource ->> 'id'                  as resource_id,
        resource -> 'meta' ->> 'versionId' as version_id,
        resource -> 'meta' ->> 'lastUpdated' as meta_last_updated,
        resource ->> 'gender'              as gender,
        resource ->> 'birthDate'           as birth_date,
        resource ->> 'active'              as active,

        
  (nullif("lastUpdated", '')::timestamptz)
 as lastUpdated_ts,   -- << quote the column
        _airbyte_extracted_at
    from "data_warehouse"."airbyte"."patient"
)
select * from src
  );
[0m14:48:08.192515 [debug] [Thread-3 (]: SQL status: BEGIN in 0.027 seconds
[0m14:48:08.193041 [debug] [Thread-4 (]: SQL status: BEGIN in 0.024 seconds
[0m14:48:08.193566 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:48:08.193994 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:48:08.194512 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:48:08.195006 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:48:08.203306 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m14:48:08.203924 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_tmp"
    
    
  as (
    select
    id as fhir_id,
    resource,
    resource ->> 'id'                            as resource_id,
    resource -> 'name' -> 0 ->> 'family'         as family_name,
    resource -> 'name' -> 0 -> 'given' ->> 0     as given_name,
    resource -> 'telecom' -> 0 ->> 'value'       as phone_raw,

    
  (nullif("lastUpdated", '')::timestamptz)
        as lastUpdated_ts,   -- << quote the column
    _airbyte_extracted_at
from "data_warehouse"."airbyte"."practitioner"
  );
[0m14:48:08.204814 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */

  create view "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_tmp"
    
    
  as (
    with base as (
    select
        id as fhir_id,
        resource,
        resource ->> 'id'            as resource_id,
        resource ->> 'status'        as status,
        resource ->> 'questionnaire' as questionnaire_canonical,

        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'subject'   ->> 'reference', '^\w+/', ''))
 as patient_id,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'encounter' ->> 'reference', '^\w+/', ''))
 as encounter_id,
        
    -- ref_text looks like 'Patient/123' -> return '123'
    (regexp_replace(resource -> 'author'    ->> 'reference', '^\w+/', ''))
 as author_id,

        
  (nullif(resource ->> 'authored', '')::timestamptz)
 as authored_ts,
        
  (nullif("lastUpdated", '')::timestamptz)
           as lastUpdated_ts,
        _airbyte_extracted_at
    from "data_warehouse"."airbyte"."questionnaire_response"
)
select * from base
  );
[0m14:48:08.208923 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:48:08.209526 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_encounter"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_encounter__dbt_tmp" rename to "stg_encounter"
[0m14:48:08.210301 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_patient" rename to "stg_patient__dbt_backup"
[0m14:48:08.212919 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:48:08.216925 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:48:08.218010 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m14:48:08.217580 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m14:48:08.218439 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_practitioner" rename to "stg_practitioner__dbt_backup"
[0m14:48:08.218886 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.008 seconds
[0m14:48:08.237654 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: COMMIT
[0m14:48:08.241694 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:48:08.245814 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:48:08.246376 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:48:08.246894 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m14:48:08.247462 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response" rename to "stg_questionnaire_response__dbt_backup"
[0m14:48:08.247970 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_tmp" rename to "stg_patient"
[0m14:48:08.251893 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:48:08.252504 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: COMMIT
[0m14:48:08.253216 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_tmp" rename to "stg_practitioner"
[0m14:48:08.253865 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:48:08.254356 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:48:08.261353 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: COMMIT
[0m14:48:08.262355 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.008 seconds
[0m14:48:08.261930 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m14:48:08.266920 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:48:08.266279 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:48:08.268682 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: COMMIT
[0m14:48:08.276932 [debug] [Thread-1 (]: Applying DROP to: "data_warehouse"."engage_analytics_stg"."stg_encounter__dbt_backup"
[0m14:48:08.277553 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: COMMIT
[0m14:48:08.278093 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */
alter table "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_tmp" rename to "stg_questionnaire_response"
[0m14:48:08.278678 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:48:08.285469 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.stg_encounter"
[0m14:48:08.286296 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: COMMIT
[0m14:48:08.286888 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_encounter"} */
drop view if exists "data_warehouse"."engage_analytics_stg"."stg_encounter__dbt_backup" cascade
[0m14:48:08.287470 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m14:48:08.287945 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:48:08.291376 [debug] [Thread-2 (]: Applying DROP to: "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_backup"
[0m14:48:08.292037 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m14:48:08.293751 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: COMMIT
[0m14:48:08.294218 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m14:48:08.295029 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.stg_patient"
[0m14:48:08.298087 [debug] [Thread-1 (]: On model.opensrp_mh.stg_encounter: Close
[0m14:48:08.298702 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:48:08.301968 [debug] [Thread-3 (]: Applying DROP to: "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_backup"
[0m14:48:08.302557 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_patient"} */
drop view if exists "data_warehouse"."engage_analytics_stg"."stg_patient__dbt_backup" cascade
[0m14:48:08.303220 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: COMMIT
[0m14:48:08.305797 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.stg_practitioner"
[0m14:48:08.306296 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba41a7a10>]}
[0m14:48:08.307111 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_practitioner"} */
drop view if exists "data_warehouse"."engage_analytics_stg"."stg_practitioner__dbt_backup" cascade
[0m14:48:08.308019 [info ] [Thread-1 (]: 1 of 13 OK created sql view model engage_analytics_stg.stg_encounter ........... [[32mCREATE VIEW[0m in 0.27s]
[0m14:48:08.308600 [debug] [Thread-4 (]: SQL status: COMMIT in 0.002 seconds
[0m14:48:08.309116 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m14:48:08.309935 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.stg_encounter
[0m14:48:08.313510 [debug] [Thread-4 (]: Applying DROP to: "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_backup"
[0m14:48:08.314014 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.004 seconds
[0m14:48:08.315837 [debug] [Thread-2 (]: On model.opensrp_mh.stg_patient: Close
[0m14:48:08.316459 [debug] [Thread-1 (]: Began running node seed.opensrp_mh.score_map
[0m14:48:08.317356 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.stg_questionnaire_response"
[0m14:48:08.319239 [debug] [Thread-3 (]: On model.opensrp_mh.stg_practitioner: Close
[0m14:48:08.320846 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba420e2a0>]}
[0m14:48:08.320138 [info ] [Thread-1 (]: 5 of 13 START seed file engage_analytics.score_map ............................. [RUN]
[0m14:48:08.321587 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.stg_questionnaire_response"} */
drop view if exists "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response__dbt_backup" cascade
[0m14:48:08.322695 [info ] [Thread-2 (]: 2 of 13 OK created sql view model engage_analytics_stg.stg_patient ............. [[32mCREATE VIEW[0m in 0.29s]
[0m14:48:08.323450 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_encounter, now seed.opensrp_mh.score_map)
[0m14:48:08.324087 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba4b17530>]}
[0m14:48:08.324985 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.stg_patient
[0m14:48:08.325531 [debug] [Thread-1 (]: Began compiling node seed.opensrp_mh.score_map
[0m14:48:08.326931 [debug] [Thread-2 (]: Began running node model.opensrp_mh.fact_encounter
[0m14:48:08.326350 [info ] [Thread-3 (]: 3 of 13 OK created sql view model engage_analytics_stg.stg_practitioner ........ [[32mCREATE VIEW[0m in 0.29s]
[0m14:48:08.327802 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.003 seconds
[0m14:48:08.328403 [debug] [Thread-1 (]: Began executing node seed.opensrp_mh.score_map
[0m14:48:08.329133 [info ] [Thread-2 (]: 6 of 13 START sql view model engage_analytics_mart.fact_encounter .............. [RUN]
[0m14:48:08.329970 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.stg_practitioner
[0m14:48:08.331835 [debug] [Thread-4 (]: On model.opensrp_mh.stg_questionnaire_response: Close
[0m14:48:08.351166 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_patient, now model.opensrp_mh.fact_encounter)
[0m14:48:08.359321 [debug] [Thread-3 (]: Began running node model.opensrp_mh.dim_patient
[0m14:48:08.365609 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:48:08.366630 [debug] [Thread-2 (]: Began compiling node model.opensrp_mh.fact_encounter
[0m14:48:08.368231 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba418e390>]}
[0m14:48:08.367509 [info ] [Thread-3 (]: 7 of 13 START sql view model engage_analytics_mart.dim_patient ................. [RUN]
[0m14:48:08.368950 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: BEGIN
[0m14:48:08.372664 [debug] [Thread-2 (]: Writing injected SQL for node "model.opensrp_mh.fact_encounter"
[0m14:48:08.373636 [info ] [Thread-4 (]: 4 of 13 OK created sql view model engage_analytics_stg.stg_questionnaire_response  [[32mCREATE VIEW[0m in 0.33s]
[0m14:48:08.374359 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_practitioner, now model.opensrp_mh.dim_patient)
[0m14:48:08.374939 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:08.375802 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.stg_questionnaire_response
[0m14:48:08.376374 [debug] [Thread-3 (]: Began compiling node model.opensrp_mh.dim_patient
[0m14:48:08.376863 [debug] [Thread-2 (]: Began executing node model.opensrp_mh.fact_encounter
[0m14:48:08.378180 [debug] [Thread-4 (]: Began running node model.opensrp_mh.dim_practitioner
[0m14:48:08.384936 [debug] [Thread-3 (]: Writing injected SQL for node "model.opensrp_mh.dim_patient"
[0m14:48:08.389142 [debug] [Thread-2 (]: Writing runtime sql for node "model.opensrp_mh.fact_encounter"
[0m14:48:08.389997 [info ] [Thread-4 (]: 8 of 13 START sql view model engage_analytics_mart.dim_practitioner ............ [RUN]
[0m14:48:08.391245 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.stg_questionnaire_response, now model.opensrp_mh.dim_practitioner)
[0m14:48:08.391986 [debug] [Thread-4 (]: Began compiling node model.opensrp_mh.dim_practitioner
[0m14:48:08.395778 [debug] [Thread-4 (]: Writing injected SQL for node "model.opensrp_mh.dim_practitioner"
[0m14:48:08.396446 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m14:48:08.397705 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.fact_encounter"
[0m14:48:08.397145 [debug] [Thread-3 (]: Began executing node model.opensrp_mh.dim_patient
[0m14:48:08.398184 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:48:08.398761 [debug] [Thread-4 (]: Began executing node model.opensrp_mh.dim_practitioner
[0m14:48:08.399205 [debug] [Thread-2 (]: On model.opensrp_mh.fact_encounter: BEGIN
[0m14:48:08.403087 [debug] [Thread-3 (]: Writing runtime sql for node "model.opensrp_mh.dim_patient"
[0m14:48:08.403686 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "seed.opensrp_mh.score_map"} */
truncate table "data_warehouse"."engage_analytics"."score_map"
[0m14:48:08.407593 [debug] [Thread-4 (]: Writing runtime sql for node "model.opensrp_mh.dim_practitioner"
[0m14:48:08.408150 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:48:08.409388 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:48:08.410433 [debug] [Thread-3 (]: On model.opensrp_mh.dim_patient: BEGIN
[0m14:48:08.410870 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:48:08.409962 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:48:08.411647 [debug] [Thread-4 (]: On model.opensrp_mh.dim_practitioner: BEGIN
[0m14:48:08.412100 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:48:08.412836 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.004 seconds
[0m14:48:08.435346 [debug] [Thread-2 (]: SQL status: BEGIN in 0.027 seconds
[0m14:48:08.436541 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:48:08.437099 [debug] [Thread-3 (]: SQL status: BEGIN in 0.026 seconds
[0m14:48:08.437676 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.fact_encounter"
[0m14:48:08.438207 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: 
          insert into "data_warehouse"."engage_analytics"."score_map" ("questionnaire_match", "link_id", "coding_code", "numeric_value") values
          (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m14:48:08.438740 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:48:08.439186 [debug] [Thread-4 (]: SQL status: BEGIN in 0.027 seconds
[0m14:48:08.439719 [debug] [Thread-2 (]: On model.opensrp_mh.fact_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_encounter"} */

  create view "data_warehouse"."engage_analytics_mart"."fact_encounter__dbt_tmp"
    
    
  as (
    select
  e.fhir_id as encounter_id,
  e.patient_id,
  e.practitioner_id,
  e.status,
  e.class_code,
  e.type_code,
  e.type_display,
  e.period_start,
  e.period_end
from "data_warehouse"."engage_analytics_stg"."stg_encounter" e
  );
[0m14:48:08.440392 [debug] [Thread-3 (]: On model.opensrp_mh.dim_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_patient"} */

  create view "data_warehouse"."engage_analytics_mart"."dim_patient__dbt_tmp"
    
    
  as (
    select
  p.fhir_id as patient_id,
  p.gender,
  (p.birth_date)::date as birth_date,
  (date_part('year', age((p.birth_date)::date)))::int as age_years,
  (p.active)::boolean as is_active
from "data_warehouse"."engage_analytics_stg"."stg_patient" p
  );
[0m14:48:08.440980 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:48:08.441573 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.001 seconds
[0m14:48:08.442182 [debug] [Thread-4 (]: On model.opensrp_mh.dim_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_practitioner"} */

  create view "data_warehouse"."engage_analytics_mart"."dim_practitioner__dbt_tmp"
    
    
  as (
    select
  pr.fhir_id as practitioner_id,
  coalesce(pr.given_name || ' ', '') || coalesce(pr.family_name,'') as practitioner_name,
  pr.phone_raw
from "data_warehouse"."engage_analytics_stg"."stg_practitioner" pr
  );
[0m14:48:08.448370 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m14:48:08.450233 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.opensrp_mh.score_map"
[0m14:48:08.450774 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m14:48:08.454808 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.fact_encounter"
[0m14:48:08.455442 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m14:48:08.459471 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:48:08.460117 [debug] [Thread-2 (]: On model.opensrp_mh.fact_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_encounter"} */
alter table "data_warehouse"."engage_analytics_mart"."fact_encounter__dbt_tmp" rename to "fact_encounter"
[0m14:48:08.463945 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:48:08.467648 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: COMMIT
[0m14:48:08.468241 [debug] [Thread-3 (]: On model.opensrp_mh.dim_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_patient"} */
alter table "data_warehouse"."engage_analytics_mart"."dim_patient__dbt_tmp" rename to "dim_patient"
[0m14:48:08.468901 [debug] [Thread-4 (]: On model.opensrp_mh.dim_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_practitioner"} */
alter table "data_warehouse"."engage_analytics_mart"."dim_practitioner__dbt_tmp" rename to "dim_practitioner"
[0m14:48:08.469441 [debug] [Thread-1 (]: Using postgres connection "seed.opensrp_mh.score_map"
[0m14:48:08.470017 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:48:08.470670 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: COMMIT
[0m14:48:08.471112 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:48:08.471602 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:48:08.473266 [debug] [Thread-2 (]: On model.opensrp_mh.fact_encounter: COMMIT
[0m14:48:08.474932 [debug] [Thread-3 (]: On model.opensrp_mh.dim_patient: COMMIT
[0m14:48:08.476492 [debug] [Thread-4 (]: On model.opensrp_mh.dim_practitioner: COMMIT
[0m14:48:08.477072 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m14:48:08.477574 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.fact_encounter"
[0m14:48:08.478102 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:48:08.478634 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:48:08.479675 [debug] [Thread-1 (]: On seed.opensrp_mh.score_map: Close
[0m14:48:08.480154 [debug] [Thread-2 (]: On model.opensrp_mh.fact_encounter: COMMIT
[0m14:48:08.480653 [debug] [Thread-3 (]: On model.opensrp_mh.dim_patient: COMMIT
[0m14:48:08.481141 [debug] [Thread-4 (]: On model.opensrp_mh.dim_practitioner: COMMIT
[0m14:48:08.482092 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba40eb8f0>]}
[0m14:48:08.483567 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m14:48:08.483064 [info ] [Thread-1 (]: 5 of 13 OK loaded seed file engage_analytics.score_map ......................... [[32mINSERT 4[0m in 0.16s]
[0m14:48:08.487042 [debug] [Thread-2 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."fact_encounter__dbt_backup"
[0m14:48:08.487611 [debug] [Thread-4 (]: SQL status: COMMIT in 0.005 seconds
[0m14:48:08.488092 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m14:48:08.488829 [debug] [Thread-1 (]: Finished running node seed.opensrp_mh.score_map
[0m14:48:08.489621 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.fact_encounter"
[0m14:48:08.492702 [debug] [Thread-4 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."dim_practitioner__dbt_backup"
[0m14:48:08.496056 [debug] [Thread-3 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."dim_patient__dbt_backup"
[0m14:48:08.496747 [debug] [Thread-1 (]: Began running node model.opensrp_mh.int_qr_answers_long
[0m14:48:08.497405 [debug] [Thread-2 (]: On model.opensrp_mh.fact_encounter: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_encounter"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."fact_encounter__dbt_backup" cascade
[0m14:48:08.498230 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.dim_practitioner"
[0m14:48:08.499005 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.dim_patient"
[0m14:48:08.499725 [info ] [Thread-1 (]: 9 of 13 START sql view model engage_analytics_int.int_qr_answers_long .......... [RUN]
[0m14:48:08.500473 [debug] [Thread-4 (]: On model.opensrp_mh.dim_practitioner: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_practitioner"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."dim_practitioner__dbt_backup" cascade
[0m14:48:08.501048 [debug] [Thread-3 (]: On model.opensrp_mh.dim_patient: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.dim_patient"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."dim_patient__dbt_backup" cascade
[0m14:48:08.501568 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:48:08.502179 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.opensrp_mh.score_map, now model.opensrp_mh.int_qr_answers_long)
[0m14:48:08.504331 [debug] [Thread-2 (]: On model.opensrp_mh.fact_encounter: Close
[0m14:48:08.504932 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.002 seconds
[0m14:48:08.505450 [debug] [Thread-1 (]: Began compiling node model.opensrp_mh.int_qr_answers_long
[0m14:48:08.505921 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.003 seconds
[0m14:48:08.507844 [debug] [Thread-4 (]: On model.opensrp_mh.dim_practitioner: Close
[0m14:48:08.508562 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba40b27b0>]}
[0m14:48:08.512739 [debug] [Thread-1 (]: Writing injected SQL for node "model.opensrp_mh.int_qr_answers_long"
[0m14:48:08.514726 [debug] [Thread-3 (]: On model.opensrp_mh.dim_patient: Close
[0m14:48:08.515825 [info ] [Thread-2 (]: 6 of 13 OK created sql view model engage_analytics_mart.fact_encounter ......... [[32mCREATE VIEW[0m in 0.16s]
[0m14:48:08.516901 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba41a6270>]}
[0m14:48:08.517940 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.fact_encounter
[0m14:48:08.518488 [debug] [Thread-1 (]: Began executing node model.opensrp_mh.int_qr_answers_long
[0m14:48:08.519163 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba40d9610>]}
[0m14:48:08.520047 [info ] [Thread-4 (]: 8 of 13 OK created sql view model engage_analytics_mart.dim_practitioner ....... [[32mCREATE VIEW[0m in 0.13s]
[0m14:48:08.524392 [debug] [Thread-1 (]: Writing runtime sql for node "model.opensrp_mh.int_qr_answers_long"
[0m14:48:08.525343 [info ] [Thread-3 (]: 7 of 13 OK created sql view model engage_analytics_mart.dim_patient ............ [[32mCREATE VIEW[0m in 0.14s]
[0m14:48:08.527135 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.dim_patient
[0m14:48:08.526230 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.dim_practitioner
[0m14:48:08.528073 [debug] [Thread-2 (]: Began running node model.opensrp_mh.patients_no_followup
[0m14:48:08.528869 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:48:08.529361 [debug] [Thread-3 (]: Began running node model.opensrp_mh.core_counts
[0m14:48:08.530651 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_long: BEGIN
[0m14:48:08.530129 [info ] [Thread-2 (]: 10 of 13 START sql view model engage_analytics_mart.patients_no_followup ....... [RUN]
[0m14:48:08.531525 [info ] [Thread-3 (]: 11 of 13 START sql view model engage_analytics_mart.core_counts ................ [RUN]
[0m14:48:08.532112 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:08.532731 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.fact_encounter, now model.opensrp_mh.patients_no_followup)
[0m14:48:08.534069 [debug] [Thread-2 (]: Began compiling node model.opensrp_mh.patients_no_followup
[0m14:48:08.533302 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.dim_patient, now model.opensrp_mh.core_counts)
[0m14:48:08.538397 [debug] [Thread-2 (]: Writing injected SQL for node "model.opensrp_mh.patients_no_followup"
[0m14:48:08.539105 [debug] [Thread-3 (]: Began compiling node model.opensrp_mh.core_counts
[0m14:48:08.543755 [debug] [Thread-3 (]: Writing injected SQL for node "model.opensrp_mh.core_counts"
[0m14:48:08.544565 [debug] [Thread-2 (]: Began executing node model.opensrp_mh.patients_no_followup
[0m14:48:08.548888 [debug] [Thread-2 (]: Writing runtime sql for node "model.opensrp_mh.patients_no_followup"
[0m14:48:08.549654 [debug] [Thread-3 (]: Began executing node model.opensrp_mh.core_counts
[0m14:48:08.550406 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m14:48:08.556867 [debug] [Thread-3 (]: Writing runtime sql for node "model.opensrp_mh.core_counts"
[0m14:48:08.557579 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:48:08.559003 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_long: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_long"} */

  create view "data_warehouse"."engage_analytics_int"."int_qr_answers_long__dbt_tmp"
    
    
  as (
    with qr as (
  select * from "data_warehouse"."engage_analytics_stg"."stg_questionnaire_response"
),
items as (
  select
    q.fhir_id as qr_id,
    q.patient_id,
    q.encounter_id,
    q.author_id,
    q.questionnaire_canonical,
    q.authored_ts,
    i ->> 'linkId' as link_id,
    i ->> 'text'   as item_text,
    a as answer
  from qr q
  left join lateral jsonb_array_elements(q.resource -> 'item') as i on true
  left join lateral jsonb_array_elements(coalesce(i->'answer','[]'::jsonb)) as a on true
),
answers as (
  select
    *,
    case
      when answer ? 'valueInteger' then (answer ->> 'valueInteger')::numeric
      when answer ? 'valueDecimal' then (answer ->> 'valueDecimal')::numeric
      when answer ? 'valueQuantity' then (answer -> 'valueQuantity' ->> 'value')::numeric
      else null
    end as value_num,
    answer -> 'valueCoding' ->> 'code'    as value_code,
    answer -> 'valueCoding' ->> 'display' as value_display,
    answer ->> 'valueString'              as value_string,
    answer ->> 'valueDate'                as value_date,
    answer ->> 'valueBoolean'             as value_boolean
  from items
)
select * from answers
  );
[0m14:48:08.558250 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.patients_no_followup"
[0m14:48:08.559713 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.core_counts"
[0m14:48:08.560291 [debug] [Thread-2 (]: On model.opensrp_mh.patients_no_followup: BEGIN
[0m14:48:08.560819 [debug] [Thread-3 (]: On model.opensrp_mh.core_counts: BEGIN
[0m14:48:08.561300 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:48:08.561842 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:48:08.563012 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:48:08.567489 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:48:08.568047 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_long: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_long"} */
alter table "data_warehouse"."engage_analytics_int"."int_qr_answers_long__dbt_tmp" rename to "int_qr_answers_long"
[0m14:48:08.569726 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:48:08.571457 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_long: COMMIT
[0m14:48:08.571975 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:48:08.572383 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_long: COMMIT
[0m14:48:08.574223 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m14:48:08.577566 [debug] [Thread-1 (]: Applying DROP to: "data_warehouse"."engage_analytics_int"."int_qr_answers_long__dbt_backup"
[0m14:48:08.578332 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_long"
[0m14:48:08.578828 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_long: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_long"} */
drop view if exists "data_warehouse"."engage_analytics_int"."int_qr_answers_long__dbt_backup" cascade
[0m14:48:08.579844 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:48:08.581657 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_long: Close
[0m14:48:08.582178 [debug] [Thread-3 (]: SQL status: BEGIN in 0.020 seconds
[0m14:48:08.582647 [debug] [Thread-2 (]: SQL status: BEGIN in 0.021 seconds
[0m14:48:08.583204 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.core_counts"
[0m14:48:08.584020 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7b8dedc0e0>]}
[0m14:48:08.584514 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.patients_no_followup"
[0m14:48:08.585045 [debug] [Thread-3 (]: On model.opensrp_mh.core_counts: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.core_counts"} */

  create view "data_warehouse"."engage_analytics_mart"."core_counts__dbt_tmp"
    
    
  as (
    -- Basic counts / indicators
with a as (select count(*) as patients from "data_warehouse"."engage_analytics_mart"."dim_patient"),
b as (select count(*) as practitioners from "data_warehouse"."engage_analytics_mart"."dim_practitioner"),
c as (select count(*) as encounters from "data_warehouse"."engage_analytics_mart"."fact_encounter"),
d as (
    select practitioner_id, count(*) as encounters_per_practitioner
    from "data_warehouse"."engage_analytics_mart"."fact_encounter"
    group by 1
)
select
  a.patients,
  b.practitioners,
  c.encounters
from a,b,c
  );
[0m14:48:08.585923 [info ] [Thread-1 (]: 9 of 13 OK created sql view model engage_analytics_int.int_qr_answers_long ..... [[32mCREATE VIEW[0m in 0.08s]
[0m14:48:08.586619 [debug] [Thread-2 (]: On model.opensrp_mh.patients_no_followup: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.patients_no_followup"} */

  create view "data_warehouse"."engage_analytics_mart"."patients_no_followup__dbt_tmp"
    
    
  as (
    -- Patients who have no encounter beyond (at most) 1 total encounter
with ec as (
  select patient_id, count(*) as encounter_count
  from "data_warehouse"."engage_analytics_mart"."fact_encounter"
  group by 1
)
select p.patient_id
from "data_warehouse"."engage_analytics_mart"."dim_patient" p
left join ec on ec.patient_id = p.patient_id
where coalesce(ec.encounter_count,0) <= 1
  );
[0m14:48:08.587544 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.int_qr_answers_long
[0m14:48:08.588519 [debug] [Thread-4 (]: Began running node model.opensrp_mh.fact_qr_latest_scores
[0m14:48:08.589051 [debug] [Thread-1 (]: Began running node model.opensrp_mh.int_qr_answers_scored
[0m14:48:08.590132 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:48:08.589705 [info ] [Thread-4 (]: 12 of 13 START sql view model engage_analytics_mart.fact_qr_latest_scores ...... [RUN]
[0m14:48:08.590776 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:48:08.591409 [info ] [Thread-1 (]: 13 of 13 START sql view model engage_analytics_int.int_qr_answers_scored ....... [RUN]
[0m14:48:08.595605 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.core_counts"
[0m14:48:08.596244 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.dim_practitioner, now model.opensrp_mh.fact_qr_latest_scores)
[0m14:48:08.600231 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.patients_no_followup"
[0m14:48:08.600893 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.opensrp_mh.int_qr_answers_long, now model.opensrp_mh.int_qr_answers_scored)
[0m14:48:08.601453 [debug] [Thread-3 (]: On model.opensrp_mh.core_counts: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.core_counts"} */
alter table "data_warehouse"."engage_analytics_mart"."core_counts__dbt_tmp" rename to "core_counts"
[0m14:48:08.601989 [debug] [Thread-4 (]: Began compiling node model.opensrp_mh.fact_qr_latest_scores
[0m14:48:08.602526 [debug] [Thread-2 (]: On model.opensrp_mh.patients_no_followup: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.patients_no_followup"} */
alter table "data_warehouse"."engage_analytics_mart"."patients_no_followup__dbt_tmp" rename to "patients_no_followup"
[0m14:48:08.603065 [debug] [Thread-1 (]: Began compiling node model.opensrp_mh.int_qr_answers_scored
[0m14:48:08.607147 [debug] [Thread-4 (]: Writing injected SQL for node "model.opensrp_mh.fact_qr_latest_scores"
[0m14:48:08.607860 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:48:08.611944 [debug] [Thread-1 (]: Writing injected SQL for node "model.opensrp_mh.int_qr_answers_scored"
[0m14:48:08.612602 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:48:08.614678 [debug] [Thread-3 (]: On model.opensrp_mh.core_counts: COMMIT
[0m14:48:08.615288 [debug] [Thread-4 (]: Began executing node model.opensrp_mh.fact_qr_latest_scores
[0m14:48:08.617161 [debug] [Thread-2 (]: On model.opensrp_mh.patients_no_followup: COMMIT
[0m14:48:08.617800 [debug] [Thread-1 (]: Began executing node model.opensrp_mh.int_qr_answers_scored
[0m14:48:08.618298 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.core_counts"
[0m14:48:08.622344 [debug] [Thread-4 (]: Writing runtime sql for node "model.opensrp_mh.fact_qr_latest_scores"
[0m14:48:08.623020 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.patients_no_followup"
[0m14:48:08.627056 [debug] [Thread-1 (]: Writing runtime sql for node "model.opensrp_mh.int_qr_answers_scored"
[0m14:48:08.627662 [debug] [Thread-3 (]: On model.opensrp_mh.core_counts: COMMIT
[0m14:48:08.628365 [debug] [Thread-2 (]: On model.opensrp_mh.patients_no_followup: COMMIT
[0m14:48:08.628921 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:48:08.629757 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_scored"
[0m14:48:08.630325 [debug] [Thread-4 (]: On model.opensrp_mh.fact_qr_latest_scores: BEGIN
[0m14:48:08.630870 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m14:48:08.631314 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_scored: BEGIN
[0m14:48:08.631776 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m14:48:08.632264 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:48:08.637898 [debug] [Thread-3 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."core_counts__dbt_backup"
[0m14:48:08.638483 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:08.641646 [debug] [Thread-2 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."patients_no_followup__dbt_backup"
[0m14:48:08.642744 [debug] [Thread-3 (]: Using postgres connection "model.opensrp_mh.core_counts"
[0m14:48:08.644373 [debug] [Thread-3 (]: On model.opensrp_mh.core_counts: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.core_counts"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."core_counts__dbt_backup" cascade
[0m14:48:08.643836 [debug] [Thread-2 (]: Using postgres connection "model.opensrp_mh.patients_no_followup"
[0m14:48:08.645092 [debug] [Thread-2 (]: On model.opensrp_mh.patients_no_followup: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.patients_no_followup"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."patients_no_followup__dbt_backup" cascade
[0m14:48:08.645682 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:48:08.647695 [debug] [Thread-3 (]: On model.opensrp_mh.core_counts: Close
[0m14:48:08.648171 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m14:48:08.650150 [debug] [Thread-2 (]: On model.opensrp_mh.patients_no_followup: Close
[0m14:48:08.650826 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba41cca40>]}
[0m14:48:08.651921 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba41cc3e0>]}
[0m14:48:08.652836 [info ] [Thread-3 (]: 11 of 13 OK created sql view model engage_analytics_mart.core_counts ........... [[32mCREATE VIEW[0m in 0.12s]
[0m14:48:08.655155 [debug] [Thread-3 (]: Finished running node model.opensrp_mh.core_counts
[0m14:48:08.653829 [info ] [Thread-2 (]: 10 of 13 OK created sql view model engage_analytics_mart.patients_no_followup .. [[32mCREATE VIEW[0m in 0.12s]
[0m14:48:08.656001 [debug] [Thread-2 (]: Finished running node model.opensrp_mh.patients_no_followup
[0m14:48:08.659367 [debug] [Thread-4 (]: SQL status: BEGIN in 0.027 seconds
[0m14:48:08.660016 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:48:08.660651 [debug] [Thread-4 (]: On model.opensrp_mh.fact_qr_latest_scores: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_qr_latest_scores"} */

  create view "data_warehouse"."engage_analytics_mart"."fact_qr_latest_scores__dbt_tmp"
    
    
  as (
    -- Example: compute latest numeric totals per questionnaire (e.g., PHQ-9 / GAD-7 / PCL-5 8)
-- Assumes numeric answers; if coded answers are used, create a mapping table and join to resolve scores.
with scored as (
  select
    patient_id,
    questionnaire_canonical,
    authored_ts,
    sum(coalesce(value_num, 0)) as total_score
  from "data_warehouse"."engage_analytics_int"."int_qr_answers_long"
  group by 1,2,3
),
latest as (
  select distinct on (patient_id, questionnaire_canonical)
    patient_id,
    questionnaire_canonical,
    authored_ts,
    total_score
  from scored
  order by patient_id, questionnaire_canonical, authored_ts desc
)
select * from latest
  );
[0m14:48:08.661369 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m14:48:08.661904 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_scored"
[0m14:48:08.662383 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_scored: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_scored"} */

  create view "data_warehouse"."engage_analytics_int"."int_qr_answers_scored__dbt_tmp"
    
    
  as (
    with a as (
  select * from "data_warehouse"."engage_analytics_int"."int_qr_answers_long"
),
map as (
  select * from "data_warehouse"."engage_analytics"."score_map"
)
select
  a.*,
  coalesce(
    a.value_num,
    case when a.value_code is not null then
      (select m.numeric_value from map m
       where a.link_id = m.link_id
         and a.value_code = m.coding_code
         and a.questionnaire_canonical ilike '%' || m.questionnaire_match || '%'
       limit 1)
    end
  ) as score_value
from a
  );
[0m14:48:08.663764 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m14:48:08.668173 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:48:08.668825 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m14:48:08.669337 [debug] [Thread-4 (]: On model.opensrp_mh.fact_qr_latest_scores: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_qr_latest_scores"} */
alter table "data_warehouse"."engage_analytics_mart"."fact_qr_latest_scores__dbt_tmp" rename to "fact_qr_latest_scores"
[0m14:48:08.673484 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_scored"
[0m14:48:08.674219 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_scored: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_scored"} */
alter table "data_warehouse"."engage_analytics_int"."int_qr_answers_scored__dbt_tmp" rename to "int_qr_answers_scored"
[0m14:48:08.675163 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:48:08.675708 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:48:08.677384 [debug] [Thread-4 (]: On model.opensrp_mh.fact_qr_latest_scores: COMMIT
[0m14:48:08.679065 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_scored: COMMIT
[0m14:48:08.679656 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:48:08.680173 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_scored"
[0m14:48:08.680691 [debug] [Thread-4 (]: On model.opensrp_mh.fact_qr_latest_scores: COMMIT
[0m14:48:08.681227 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_scored: COMMIT
[0m14:48:08.683142 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m14:48:08.683702 [debug] [Thread-4 (]: SQL status: COMMIT in 0.002 seconds
[0m14:48:08.686993 [debug] [Thread-1 (]: Applying DROP to: "data_warehouse"."engage_analytics_int"."int_qr_answers_scored__dbt_backup"
[0m14:48:08.690379 [debug] [Thread-4 (]: Applying DROP to: "data_warehouse"."engage_analytics_mart"."fact_qr_latest_scores__dbt_backup"
[0m14:48:08.691307 [debug] [Thread-1 (]: Using postgres connection "model.opensrp_mh.int_qr_answers_scored"
[0m14:48:08.692125 [debug] [Thread-4 (]: Using postgres connection "model.opensrp_mh.fact_qr_latest_scores"
[0m14:48:08.692665 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_scored: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.int_qr_answers_scored"} */
drop view if exists "data_warehouse"."engage_analytics_int"."int_qr_answers_scored__dbt_backup" cascade
[0m14:48:08.693199 [debug] [Thread-4 (]: On model.opensrp_mh.fact_qr_latest_scores: /* {"app": "dbt", "dbt_version": "1.10.9", "profile_name": "opensrp_mh", "target_name": "prod", "node_id": "model.opensrp_mh.fact_qr_latest_scores"} */
drop view if exists "data_warehouse"."engage_analytics_mart"."fact_qr_latest_scores__dbt_backup" cascade
[0m14:48:08.694633 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:48:08.696567 [debug] [Thread-1 (]: On model.opensrp_mh.int_qr_answers_scored: Close
[0m14:48:08.697046 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.003 seconds
[0m14:48:08.698919 [debug] [Thread-4 (]: On model.opensrp_mh.fact_qr_latest_scores: Close
[0m14:48:08.699685 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7b8dec6690>]}
[0m14:48:08.701360 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6f7e75b-e5ba-4ef8-aefa-ec6ff8e8b196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7b8df2f3b0>]}
[0m14:48:08.700733 [info ] [Thread-1 (]: 13 of 13 OK created sql view model engage_analytics_int.int_qr_answers_scored .. [[32mCREATE VIEW[0m in 0.10s]
[0m14:48:08.702374 [info ] [Thread-4 (]: 12 of 13 OK created sql view model engage_analytics_mart.fact_qr_latest_scores . [[32mCREATE VIEW[0m in 0.11s]
[0m14:48:08.703173 [debug] [Thread-1 (]: Finished running node model.opensrp_mh.int_qr_answers_scored
[0m14:48:08.703909 [debug] [Thread-4 (]: Finished running node model.opensrp_mh.fact_qr_latest_scores
[0m14:48:08.706126 [debug] [MainThread]: Using postgres connection "master"
[0m14:48:08.706615 [debug] [MainThread]: On master: BEGIN
[0m14:48:08.706951 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:48:08.722697 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m14:48:08.723246 [debug] [MainThread]: On master: COMMIT
[0m14:48:08.723656 [debug] [MainThread]: Using postgres connection "master"
[0m14:48:08.723993 [debug] [MainThread]: On master: COMMIT
[0m14:48:08.724700 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:48:08.725104 [debug] [MainThread]: On master: Close
[0m14:48:08.725825 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:48:08.726183 [debug] [MainThread]: Connection 'model.opensrp_mh.patients_no_followup' was properly closed.
[0m14:48:08.726513 [debug] [MainThread]: Connection 'model.opensrp_mh.int_qr_answers_scored' was properly closed.
[0m14:48:08.726826 [debug] [MainThread]: Connection 'model.opensrp_mh.fact_qr_latest_scores' was properly closed.
[0m14:48:08.727105 [debug] [MainThread]: Connection 'model.opensrp_mh.core_counts' was properly closed.
[0m14:48:08.727570 [info ] [MainThread]: 
[0m14:48:08.727982 [info ] [MainThread]: Finished running 1 seed, 12 view models in 0 hours 0 minutes and 1.05 seconds (1.05s).
[0m14:48:08.730493 [debug] [MainThread]: Command end result
[0m14:48:08.765506 [debug] [MainThread]: Wrote artifact WritableManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/manifest.json
[0m14:48:08.768147 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/semantic_manifest.json
[0m14:48:08.775432 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/dbt/fhir-analytics-repo/engage-analytics/dbt/target/run_results.json
[0m14:48:08.775917 [info ] [MainThread]: 
[0m14:48:08.776355 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:48:08.776750 [info ] [MainThread]: 
[0m14:48:08.777145 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m14:48:08.778343 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.8060508, "process_in_blocks": "0", "process_kernel_time": 0.337771, "process_mem_max_rss": "133664", "process_out_blocks": "4240", "process_user_time": 5.347475}
[0m14:48:08.778957 [debug] [MainThread]: Command `dbt build` succeeded at 14:48:08.778836 after 3.81 seconds
[0m14:48:08.779378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba7df0830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba64d7cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfa7ba75a3470>]}
[0m14:48:08.779865 [debug] [MainThread]: Flushing usage events
[0m14:48:08.832627 [debug] [MainThread]: An error was encountered while trying to flush usage events

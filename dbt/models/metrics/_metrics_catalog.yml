version: 2

docs:
  - name: metrics_catalog
    description: |
      - id: provider_count
        unit: count
        grain: day
        entity_keys: [organization_id]
        source_model: practitioners
        expression: "count(distinct id)"
        description: "Total number of unique providers"
        version: v1
        
      - id: patient_count
        unit: count
        grain: day
        entity_keys: [practitioner_organization_id]
        source_model: patient
        expression: "count(distinct id)"
        description: "Total number of unique patients"
        version: v1

      - id: client_encounters
        unit: count
        grain: day
        entity_keys: [practitioner_organization_id]
        source_model: encounters
        expression: "count(distinct subject_id)"
        description: "Total unique clients seen (one encounter per patient per day)"
        version: v1

      - id: active_providers
        unit: count
        grain: day
        entity_keys: [organization_id]
        source_model: active_providers
        expression: "count(distinct case when is_active_30d then practitioner_id end)"
        description: "Providers who submitted QRs in past 30 days"
        version: v1

      - id: percent_active_providers
        unit: percent
        grain: day
        entity_keys: [organization_id]
        source_model: active_providers
        numerator: "count(distinct case when is_active_30d then practitioner_id end)"
        denominator: "nullif(count(distinct practitioner_id), 0)"
        description: "Percentage of providers active in past 30 days"
        version: v1